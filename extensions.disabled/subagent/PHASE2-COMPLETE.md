# é˜¶æ®µ 2 å®ŒæˆæŠ¥å‘Šï¼šæ™ºæ…§ç§¯ç´¯ç³»ç»Ÿ

## å®Œæˆæ—¶é—´

2026-01-27

## å®æ–½å†…å®¹

### 1. åˆ›å»º Notepad ç›®å½•ç»“æ„ âœ…

#### `~/.pi/agent/notepads/`
- `learnings.md` - ç´¯ç§¯æ™ºæ…§ï¼ˆä¸»æ–‡ä»¶ï¼‰
- `decisions.md` - æ¶æ„å†³ç­–è®°å½•
- `issues.md` - é—®é¢˜ä¸é˜»å¡
- `verification.md` - éªŒè¯ç»“æœ
- `problems.md` - æœªè§£å†³é—®é¢˜

### 2. å®ç°æ™ºæ…§å·¥å…· âœ…

#### `~/.pi/agent/extensions/subagent/utils/wisdom.ts`
- `extractWisdom()` - ä»å­ä»£ç†è¾“å‡ºæå–æ™ºæ…§
- `appendWisdom()` - è¿½åŠ æ™ºæ…§åˆ° notepad
- `loadWisdom()` - åŠ è½½ç´¯ç§¯çš„æ™ºæ…§
- `formatWisdomForPrompt()` - æ ¼å¼åŒ–æ™ºæ…§ç”¨äºæ³¨å…¥
- `getWisdomStats()` - è·å–æ™ºæ…§ç»Ÿè®¡

### 3. ä¿®æ”¹ Single Mode âœ…

#### `~/.pi/agent/extensions/subagent/modes/single.ts`
- è‡ªåŠ¨åŠ è½½æ™ºæ…§
- è‡ªåŠ¨æ³¨å…¥æ™ºæ…§åˆ°ä»»åŠ¡æç¤º
- æ‰§è¡Œåè‡ªåŠ¨æå–æ™ºæ…§
- è‡ªåŠ¨è¿½åŠ æ™ºæ…§åˆ° notepad

### 4. å®ç° `/wisdom` å‘½ä»¤ âœ…

- æ˜¾ç¤ºæ™ºæ…§ç»Ÿè®¡
- æ˜¾ç¤ºå„ç±»å‹æ•°é‡
- æ˜¾ç¤ºæœ€è¿‘çš„æ™ºæ…§æ¡ç›®
- æä¾›ä½¿ç”¨è¯´æ˜

### 5. æµ‹è¯•éªŒè¯ âœ…

#### æµ‹è¯•æ–‡ä»¶ï¼š`test-wisdom.ts`
- æ™ºæ…§æå–æµ‹è¯• âœ…
- æ™ºæ…§è¿½åŠ æµ‹è¯• âœ…
- æ™ºæ…§åŠ è½½æµ‹è¯• âœ…
- æ™ºæ…§æ ¼å¼åŒ–æµ‹è¯• âœ…
- æ™ºæ…§ç»Ÿè®¡æµ‹è¯• âœ…

æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼

### 6. æ–‡æ¡£ç¼–å†™ âœ…

#### `WISDOM.md`
- å®Œæ•´çš„ä½¿ç”¨æŒ‡å—
- æ™ºæ…§ç±»å‹è¯´æ˜
- å·¥ä½œæµç¨‹
- ç¤ºä¾‹åœºæ™¯
- æœ€ä½³å®è·µ
- æ•…éšœæ’é™¤

## æ™ºæ…§ç±»å‹ï¼ˆ6 ç§ï¼‰

| ç±»å‹ | æ ‡è®° | ç”¨é€” |
|------|------|------|
| Convention | `Convention:` æˆ– `çº¦å®š:` | ç¼–ç çº¦å®šã€æ¨¡å¼ã€é£æ ¼ |
| Success | `Success:` æˆ– `æˆåŠŸ:` æˆ– `âœ…:` | æˆåŠŸçš„æ–¹æ³•ã€æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ |
| Failure | `Failure:` æˆ– `å¤±è´¥:` æˆ– `âŒ:` | å¤±è´¥çš„å°è¯•ã€åº”é¿å…çš„åšæ³• |
| Gotcha | `Gotcha:` æˆ– `é™·é˜±:` æˆ– `âš ï¸:` | å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ã€éœ€è¦æ³¨æ„çš„ç»†èŠ‚ |
| Command | `Command:` æˆ– `å‘½ä»¤:` | æœ‰ç”¨çš„å‘½ä»¤ã€è„šæœ¬ã€å·¥å…·ä½¿ç”¨ |
| Decision | `Decision:` æˆ– `å†³ç­–:` | æ¶æ„å†³ç­–å’Œç†ç”± |

## å·¥ä½œæµç¨‹

### è‡ªåŠ¨æå–

```
å­ä»£ç†è¾“å‡º
    â†“
æ‰«æç‰¹å®šæ ‡è®°
    â†“
æå–æ™ºæ…§æ¡ç›®
    â†“
è¿½åŠ åˆ° learnings.md
```

### è‡ªåŠ¨æ³¨å…¥

```
æ–°ä»»åŠ¡
    â†“
åŠ è½½ç´¯ç§¯æ™ºæ…§
    â†“
æ ¼å¼åŒ–ä¸ºæç¤º
    â†“
å¢å¼ºä»»åŠ¡æç¤º
    â†“
æ‰§è¡Œå­ä»£ç†
```

## ä½¿ç”¨ç¤ºä¾‹

### ä»£ç†è¾“å‡ºä¸­æ ‡è®°æ™ºæ…§

```markdown
æˆ‘å·²å®Œæˆä»»åŠ¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å­¦ä¹ ï¼š

Convention: é¡¹ç›®ä½¿ç”¨ TypeScript strict mode
Success: âœ… ä½¿ç”¨ async/await æé«˜å¯è¯»æ€§
Failure: âŒ ä¸è¦ä½¿ç”¨ any ç±»å‹
Gotcha: âš ï¸ è®°å¾—å¤„ç† Promise rejection
Command: `npm run test -- --coverage`
Decision: å†³å®šä½¿ç”¨ Bun è€Œé Node.js
```

### æŸ¥çœ‹æ™ºæ…§

```bash
# æŸ¥çœ‹æ™ºæ…§ç»Ÿè®¡
/wisdom

# ç›´æ¥æŸ¥çœ‹æ–‡ä»¶
bat ~/.pi/agent/notepads/learnings.md
```

### ç¦ç”¨æ™ºæ…§æ³¨å…¥ï¼ˆå¯é€‰ï¼‰

```javascript
subagent({ 
  agent: "worker", 
  task: "...", 
  injectWisdom: false 
})
```

## æ ¸å¿ƒä¼˜åŠ¿

### 1. ç´¯ç§¯å­¦ä¹ 
æ¯æ¬¡ä»»åŠ¡éƒ½ç§¯ç´¯ç»éªŒï¼Œåç»­ä»»åŠ¡è‡ªåŠ¨è·å¾—ã€‚

### 2. ä¿æŒä¸€è‡´æ€§
æ‰€æœ‰ä»£ç†éµå¾ªç›¸åŒçš„çº¦å®šå’Œæ¨¡å¼ã€‚

### 3. é¿å…é‡å¤é”™è¯¯
å¤±è´¥çš„å°è¯•è¢«è®°å½•ï¼Œè‡ªåŠ¨é¿å…ã€‚

### 4. çŸ¥è¯†ä¼ é€’
æ–°ä»£ç†è‡ªåŠ¨è·å¾—ä¹‹å‰ä»»åŠ¡çš„ç»éªŒã€‚

## æŠ€æœ¯å®ç°

### æå–æ¨¡å¼

```typescript
// æ”¯æŒçš„æ ‡è®°æ ¼å¼
Convention: ...
çº¦å®š: ...

Success: ...
æˆåŠŸ: ...
âœ…: ...

Failure: ...
å¤±è´¥: ...
âŒ: ...

Gotcha: ...
é™·é˜±: ...
âš ï¸: ...

Command: `...`
å‘½ä»¤: `...`

Decision: ...
å†³ç­–: ...
```

### æ³¨å…¥æ ¼å¼

```markdown
## ç´¯ç§¯æ™ºæ…§ (Accumulated Wisdom)

ä»¥ä¸‹æ˜¯ä»ä¹‹å‰çš„ä»»åŠ¡ä¸­æå–çš„å­¦ä¹ ã€æ¨¡å¼å’Œç»éªŒã€‚è¯·éµå¾ªè¿™äº›çº¦å®šå’Œæœ€ä½³å®è·µï¼š

## ğŸ“‹ Convention (patterns)
...

## âœ… Success (solutions)
...

## âŒ Failure (pitfalls)
...

---
```

## æ–‡ä»¶æ¸…å•

```
~/.pi/agent/
â”œâ”€â”€ notepads/
â”‚   â”œâ”€â”€ learnings.md                         # ç´¯ç§¯æ™ºæ…§
â”‚   â”œâ”€â”€ decisions.md                         # æ¶æ„å†³ç­–
â”‚   â”œâ”€â”€ issues.md                            # é—®é¢˜ä¸é˜»å¡
â”‚   â”œâ”€â”€ verification.md                      # éªŒè¯ç»“æœ
â”‚   â””â”€â”€ problems.md                          # æœªè§£å†³é—®é¢˜
â””â”€â”€ extensions/subagent/
    â”œâ”€â”€ utils/wisdom.ts                      # æ™ºæ…§å·¥å…·
    â”œâ”€â”€ modes/single.ts                      # ä¿®æ”¹ï¼šæ™ºæ…§æ³¨å…¥
    â”œâ”€â”€ index.ts                             # ä¿®æ”¹ï¼š/wisdom å‘½ä»¤
    â”œâ”€â”€ test-wisdom.ts                       # æµ‹è¯•æ–‡ä»¶
    â””â”€â”€ WISDOM.md                            # æ–‡æ¡£
```

## æµ‹è¯•ç»“æœ

```
=== Testing Wisdom Accumulation ===

1. Testing wisdom extraction...
âœ… Extracted 6 wisdom notes

2. Testing wisdom append...
âœ… Wisdom appended to learnings.md

3. Testing wisdom load...
âœ… Loaded wisdom (2033 characters)

4. Testing wisdom formatting...
âœ… Formatted wisdom (568 characters)

5. Testing wisdom stats...
âœ… Total notes: 12
   By type:
   - convention: 2
   - success: 2
   - failure: 2
   - gotcha: 2
   - command: 2
   - decision: 2

=== Test Complete ===
```

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1ï¼šä¿æŒç¼–ç çº¦å®š

```javascript
// ä»»åŠ¡ 1
subagent({ agent: "worker", task: "å®ç°ç”¨æˆ·è®¤è¯" })
// è¾“å‡º: Convention: ä½¿ç”¨ bcrypt è¿›è¡Œå¯†ç å“ˆå¸Œ

// ä»»åŠ¡ 2ï¼ˆè‡ªåŠ¨æ³¨å…¥æ™ºæ…§ï¼‰
subagent({ agent: "worker", task: "å®ç°ç”¨æˆ·æ³¨å†Œ" })
// è‡ªåŠ¨éµå¾ª bcrypt çº¦å®š
```

### åœºæ™¯ 2ï¼šé¿å…é‡å¤é”™è¯¯

```javascript
// ä»»åŠ¡ 1
subagent({ agent: "worker", task: "å®ç°æ–‡ä»¶ä¸Šä¼ " })
// è¾“å‡º: Failure: âŒ ä¸è¦åœ¨å†…å­˜ä¸­ç¼“å­˜å¤§æ–‡ä»¶

// ä»»åŠ¡ 2ï¼ˆè‡ªåŠ¨æ³¨å…¥æ™ºæ…§ï¼‰
subagent({ agent: "worker", task: "å®ç°å›¾ç‰‡ä¸Šä¼ " })
// è‡ªåŠ¨é¿å…å†…å­˜ç¼“å­˜ï¼Œä½¿ç”¨æµå¼å¤„ç†
```

## ä¸‹ä¸€æ­¥

é˜¶æ®µ 2 å·²å®Œæˆï¼å¯ä»¥ç»§ç»­ï¼š

### é˜¶æ®µ 3ï¼šå¹¶è¡Œä¼˜åŒ–ï¼ˆ1-2 å¤©ï¼‰
- ä»»åŠ¡ä¾èµ–åˆ†æ
- å¹¶è¡Œä»»åŠ¡ç»„è¯†åˆ«
- å¢å¼ºé“¾å¼æ¨¡å¼

### é˜¶æ®µ 4ï¼šTODO å¼ºåˆ¶ï¼ˆ1 å¤©ï¼‰
- æ›´æ–°ä»£ç†æç¤º
- å®ç° TODO ç›‘æ§
- æ·»åŠ  Hook

## éªŒè¯æ¸…å•

- [x] Notepad ç›®å½•åˆ›å»º
- [x] æ™ºæ…§å·¥å…·å®ç°
- [x] Single Mode ä¿®æ”¹
- [x] `/wisdom` å‘½ä»¤
- [x] æµ‹è¯•éªŒè¯
- [x] æ–‡æ¡£ç¼–å†™

## æ€»ç»“

é˜¶æ®µ 2 **æ™ºæ…§ç§¯ç´¯ç³»ç»Ÿ**å·²æˆåŠŸå®æ–½ï¼

- âœ… 6 ç§æ™ºæ…§ç±»å‹
- âœ… è‡ªåŠ¨æå–å’Œè¿½åŠ 
- âœ… è‡ªåŠ¨åŠ è½½å’Œæ³¨å…¥
- âœ… `/wisdom` å‘½ä»¤
- âœ… Notepad æ–‡ä»¶ç³»ç»Ÿ
- âœ… å…¨é¢çš„æ–‡æ¡£
- âœ… æµ‹è¯•éªŒè¯é€šè¿‡

ç³»ç»Ÿç°åœ¨æ”¯æŒç´¯ç§¯å­¦ä¹ ï¼Œæ¯æ¬¡ä»»åŠ¡çš„ç»éªŒéƒ½ä¼šè‡ªåŠ¨ä¼ é€’ç»™åç»­ä»»åŠ¡ï¼Œå®ç°çŸ¥è¯†ç§¯ç´¯å’Œä¸€è‡´æ€§ä¿æŒã€‚
