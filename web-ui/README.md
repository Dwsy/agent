# pi-mono Web UI æ‰©å±•å¼€å‘æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [ç›®å½•ç»“æ„](#ç›®å½•ç»“æ„)
- [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)
- [API è®¾è®¡](#api-è®¾è®¡)
- [ç»„ä»¶è®¾è®¡](#ç»„ä»¶è®¾è®¡)
- [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
- [æµ‹è¯•è®¡åˆ’](#æµ‹è¯•è®¡åˆ’)
- [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)

---

## é¡¹ç›®æ¦‚è¿°

### ç›®æ ‡

ä¸º `pi-mono/coding-agent` å¼€å‘ä¸€ä¸ªç±»ä¼¼ OpenCodeWebUI çš„ Web UI æ‰©å±•ï¼Œæä¾›ç°ä»£åŒ–çš„æµè§ˆå™¨ç•Œé¢ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **èŠå¤©ç•Œé¢**ï¼šåŸºäºç°æœ‰ `AgentInterface` ç»„ä»¶
- âœ… **æµå¼æ¶ˆæ¯**ï¼šSSE å®æ—¶äº‹ä»¶æµ
- âœ… **å·¥å…·æ¸²æŸ“**ï¼šå®Œæ•´çš„å·¥å…·æ‰§è¡Œå¯è§†åŒ–
- âœ… **Artifacts**ï¼šäº¤äº’å¼ HTML/SVG/Markdown é¢„è§ˆ
- âœ… **é™„ä»¶æ”¯æŒ**ï¼šPDF/DOCX/XLSX/PPTX/å›¾ç‰‡
- âœ… **ä¼šè¯ç®¡ç†**ï¼šå¤šä¼šè¯ã€æŒä¹…åŒ–
- âœ… **æ–‡ä»¶æµè§ˆå™¨**ï¼šé¡¹ç›®æ–‡ä»¶æ ‘
- âœ… **ç»ˆç«¯é›†æˆ**ï¼šå‘½ä»¤è¾“å‡ºå±•ç¤º

### è®¾è®¡åŸåˆ™

1. **æœ€å¤§åŒ–å¤ç”¨**ï¼šå¤ç”¨ `@mariozechner/pi-web-ui` ç»„ä»¶
2. **æœ€å°åŒ–æ”¹åŠ¨**ï¼šä¸ç ´åç°æœ‰æ¶æ„
3. **æ¸è¿›å¢å¼º**ï¼šå¯é€æ­¥æ·»åŠ åŠŸèƒ½
4. **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰ CLI åŠŸèƒ½

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        pi CLI (ä¸»è¿›ç¨‹)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AgentSession (æ ¸å¿ƒä¼šè¯å¼•æ“)                                â”‚ â”‚
â”‚  â”‚  - çŠ¶æ€ç®¡ç†                                                 â”‚ â”‚
â”‚  â”‚  - æ¶ˆæ¯å†å²                                                 â”‚ â”‚
â”‚  â”‚  - å·¥å…·æ‰§è¡Œ                                                 â”‚ â”‚
â”‚  â”‚  - äº‹ä»¶ç³»ç»Ÿ                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  WebServer Extension (Hono + SSE)                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  HTTP Server                                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /global/health (å¥åº·æ£€æŸ¥)                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /global/event (SSE äº‹ä»¶æµ) â­                     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /sessions/* (ä¼šè¯ç®¡ç†)                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /messages/* (æ¶ˆæ¯æ“ä½œ)                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /tools/* (å·¥å…· API)                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - /file/* (æ–‡ä»¶æ“ä½œ)                                â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“ (HTTP + SSE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    pi-web-ui-app (å‰ç«¯åº”ç”¨)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Layout / Shell                                            â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚  Sidebar     â”‚  â”‚  Main Area                       â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  (æ–°å¢)      â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  - ä¼šè¯åˆ—è¡¨  â”‚  â”‚  â”‚ AgentInterface (å¤ç”¨) â­    â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  - è®¾ç½®      â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  - æ–°å»ºä¼šè¯  â”‚  â”‚  â”‚ FileTree (æ–°å¢) â­         â”‚  â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚   â”‚ â”‚
â”‚  â”‚                   â”‚  â”‚  Terminal (æ–°å¢) â­         â”‚  â”‚   â”‚ â”‚
â”‚  â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚ â”‚
â”‚  â”‚                   â”‚                                   â”‚   â”‚ â”‚
â”‚  â”‚                   â”‚  Dialogs (å¤ç”¨) â­                â”‚   â”‚ â”‚
â”‚  â”‚                   â”‚  - SettingsDialog                 â”‚   â”‚ â”‚
â”‚  â”‚                   â”‚  - SessionListDialog              â”‚   â”‚ â”‚
â”‚  â”‚                   â”‚  - ModelSelector                  â”‚   â”‚ â”‚
â”‚  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Context Layer                                             â”‚ â”‚
â”‚  â”‚  - ServerContext (SSE è¿æ¥ç®¡ç†) â­                         â”‚ â”‚
â”‚  â”‚  - SessionContext (ä¼šè¯çŠ¶æ€)                              â”‚ â”‚
â”‚  â”‚  - FileContext (æ–‡ä»¶çŠ¶æ€)                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶å¤ç”¨æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    @mariozechner/pi-web-ui                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ChatPanel (é«˜å±‚ç»„ä»¶)                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ AgentInterface â­ ç›´æ¥å¤ç”¨                        â”‚   â”‚
â”‚  â”‚  â”œâ”€ ArtifactsPanel â­ ç›´æ¥å¤ç”¨                        â”‚   â”‚
â”‚  â”‚  â””â”€ MessageList â­ ç›´æ¥å¤ç”¨                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Dialogs â­ ç›´æ¥å¤ç”¨                                  â”‚   â”‚
â”‚  â”‚  - SettingsDialog                                     â”‚   â”‚
â”‚  â”‚  - SessionListDialog                                  â”‚   â”‚
â”‚  â”‚  - ModelSelector                                      â”‚   â”‚
â”‚  â”‚  - ApiKeyPromptDialog                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Storage â­ å¯é€‰å¤ç”¨                                   â”‚   â”‚
â”‚  â”‚  - SessionsStore                                      â”‚   â”‚
â”‚  â”‚  - ProviderKeysStore                                  â”‚   â”‚
â”‚  â”‚  - SettingsStore                                      â”‚   â”‚
â”‚  â”‚  - IndexedDBStorageBackend                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Tools â­ ç›´æ¥å¤ç”¨                                    â”‚   â”‚
â”‚  â”‚  - ArtifactsPanel                                     â”‚   â”‚
â”‚  â”‚  - BashRenderer                                       â”‚   â”‚
â”‚  â”‚  - ToolRenderer Registry                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    pi-web-ui-app (æ–°å¢åŒ…è£…å±‚)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Layout Components â­ æ–°å¢                            â”‚   â”‚
â”‚  â”‚  - Sidebar                                            â”‚   â”‚
â”‚  â”‚  - FileTree                                           â”‚   â”‚
â”‚  â”‚  - Terminal                                           â”‚   â”‚
â”‚  â”‚  - SplitView                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Context â­ æ–°å¢                                      â”‚   â”‚
â”‚  â”‚  - ServerContext (SSE è¿æ¥)                          â”‚   â”‚
â”‚  â”‚  - SessionContext (ä¼šè¯çŠ¶æ€)                         â”‚   â”‚
â”‚  â”‚  - FileContext (æ–‡ä»¶çŠ¶æ€)                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ (Web UI)
    â†“
ç”¨æˆ·è¾“å…¥æ¶ˆæ¯
    â†“
ServerContext.send({ type: "prompt", message })
    â†“
HTTP POST /sessions/current/messages
    â†“
WebServer (Hono)
    â†“
AgentSession.prompt(message)
    â†“
Agent Loop (pi-agent-core)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Agent Execution Flow                                    â”‚
â”‚  1. è½¬æ¢æ¶ˆæ¯ (convertToLlm)                              â”‚
â”‚  2. è°ƒç”¨ LLM API                                         â”‚
â”‚  3. æµå¼æ¥æ”¶å“åº”                                          â”‚
â”‚  4. æ‰§è¡Œå·¥å…·è°ƒç”¨                                          â”‚
â”‚  5. æ›´æ–°ä¼šè¯çŠ¶æ€                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
AgentEvent ç”Ÿæˆ
    â†“
session.subscribe() å›è°ƒ
    â†“
SSE Stream (/global/event)
    â†“
ServerContext.subscribe() æ¥æ”¶
    â†“
UI æ›´æ–°
    â”œâ”€ AgentInterface (æ¶ˆæ¯æ›´æ–°)
    â”œâ”€ FileTree (æ–‡ä»¶å˜åŒ–)
    â””â”€ Terminal (è¾“å‡ºæ˜¾ç¤º)
```

---

## æŠ€æœ¯æ ˆ

### åç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| Hono | ^4.0.0 | HTTP æœåŠ¡å™¨ |
| TypeScript | ^5.7.0 | ç±»å‹å®‰å…¨ |
| Deno | latest | è¿è¡Œæ—¶ï¼ˆå¯é€‰ Node.jsï¼‰ |

### å‰ç«¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| SolidJS | ^1.8.0 | å“åº”å¼æ¡†æ¶ |
| @solidjs/router | ^0.10.0 | å®¢æˆ·ç«¯è·¯ç”± |
| Vite | ^5.0.0 | æ„å»ºå·¥å…· |
| Tailwind CSS | ^3.4.0 | æ ·å¼ç³»ç»Ÿ |
| @mariozechner/pi-web-ui | latest | å¤ç”¨ç»„ä»¶ |

### å¼€å‘å·¥å…·

| æŠ€æœ¯ | ç”¨é€” |
|------|------|
| TypeScript | ç±»å‹æ£€æŸ¥ |
| ESLint | ä»£ç è§„èŒƒ |
| Prettier | ä»£ç æ ¼å¼åŒ– |
| Vitest | å•å…ƒæµ‹è¯• |

### ä¾èµ–å¯¹æ¯”

```
pi-mono ç°æœ‰ä¾èµ–:
â”œâ”€â”€ @mariozechner/pi-web-ui (Lit + Web Components)
â”œâ”€â”€ @mariozechner/pi-agent-core
â”œâ”€â”€ @mariozechner/pi-ai
â””â”€â”€ @mariozechner/mini-lit

æ–°å¢ä¾èµ–:
â”œâ”€â”€ hono (åç«¯ HTTP æœåŠ¡å™¨)
â”œâ”€â”€ solid-js (å‰ç«¯æ¡†æ¶)
â”œâ”€â”€ @solidjs/router (è·¯ç”±)
â”œâ”€â”€ @solid-primitives/event-source (SSE)
â””â”€â”€ vite (æ„å»ºå·¥å…·)
```

---

## ç›®å½•ç»“æ„

### å®Œæ•´ç›®å½•ç»“æ„

```
pi-mono/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ coding-agent/                    # ç°æœ‰åŒ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ agent-session.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ extensions/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ modes/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ interactive/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ print-mode.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rpc/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ web/                    # â­ æ–°å¢
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ server.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ sse.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ routes/
â”‚   â”‚   â”‚   â”‚           â”œâ”€â”€ sessions.ts
â”‚   â”‚   â”‚   â”‚           â”œâ”€â”€ messages.ts
â”‚   â”‚   â”‚   â”‚           â”œâ”€â”€ tools.ts
â”‚   â”‚   â”‚   â”‚           â””â”€â”€ files.ts
â”‚   â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â”œâ”€â”€ web-ui/                           # ç°æœ‰åŒ…ï¼ˆå¤ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ ChatPanel.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ AgentInterface.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ dialogs/
â”‚   â”‚   â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ example/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚
â”‚   â””â”€â”€ web-ui-app/                       # â­ æ–°å¢åŒ…
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ app.tsx
â”‚       â”‚   â”œâ”€â”€ main.tsx
â”‚       â”‚   â”œâ”€â”€ components/
â”‚       â”‚   â”‚   â”œâ”€â”€ Layout/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ AppShell.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ SidebarHeader.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ SidebarItem.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ MainArea/
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ ChatArea.tsx
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ FileTree.tsx
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ Terminal.tsx
â”‚       â”‚   â”‚   â””â”€â”€ common/
â”‚       â”‚   â”‚       â””â”€â”€ Loading.tsx
â”‚       â”‚   â”œâ”€â”€ context/
â”‚       â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚       â”‚   â”‚   â”œâ”€â”€ session.ts
â”‚       â”‚   â”‚   â””â”€â”€ file.ts
â”‚       â”‚   â”œâ”€â”€ hooks/
â”‚       â”‚   â”‚   â”œâ”€â”€ useServerConnection.ts
â”‚       â”‚   â”‚   â””â”€â”€ useAutoScroll.ts
â”‚       â”‚   â”œâ”€â”€ types/
â”‚       â”‚   â”‚   â””â”€â”€ index.ts
â”‚       â”‚   â””â”€â”€ utils/
â”‚       â”‚       â”œâ”€â”€ event-adapter.ts
â”‚       â”‚       â””â”€â”€ logger.ts
â”‚       â”œâ”€â”€ public/
â”‚       â”‚   â””â”€â”€ favicon.ico
â”‚       â”œâ”€â”€ index.html
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ tsconfig.json
â”‚       â”œâ”€â”€ vite.config.ts
â”‚       â””â”€â”€ tailwind.config.ts
â”‚
â””â”€â”€ package.json
```

### æ–‡ä»¶è¯´æ˜

#### åç«¯ (packages/coding-agent/src/modes/web/)

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `index.ts` | æ¨¡å¼å…¥å£ï¼Œå¯¼å‡º `runWebMode` |
| `server.ts` | Hono HTTP æœåŠ¡å™¨ä¸»ç±» |
| `sse.ts` | SSE äº‹ä»¶æµå¤„ç† |
| `routes/sessions.ts` | ä¼šè¯ç®¡ç† API |
| `routes/messages.ts` | æ¶ˆæ¯æ“ä½œ API |
| `routes/tools.ts` | å·¥å…· API |
| `routes/files.ts` | æ–‡ä»¶æ“ä½œ API |

#### å‰ç«¯ (packages/web-ui-app/src/)

| æ–‡ä»¶/ç›®å½• | è¯´æ˜ |
|-----------|------|
| `app.tsx` | åº”ç”¨æ ¹ç»„ä»¶ |
| `main.tsx` | åº”ç”¨å…¥å£ |
| `components/Layout/` | å¸ƒå±€ç»„ä»¶ï¼ˆæ–°å¢ï¼‰ |
| `components/MainArea/` | ä¸»åŒºåŸŸç»„ä»¶ï¼ˆæ–°å¢ï¼‰ |
| `context/` | React Contextï¼ˆæ–°å¢ï¼‰ |
| `hooks/` | è‡ªå®šä¹‰ Hooksï¼ˆæ–°å¢ï¼‰ |
| `types/` | TypeScript ç±»å‹å®šä¹‰ |
| `utils/` | å·¥å…·å‡½æ•° |

---

## å®æ–½è®¡åˆ’

### é˜¶æ®µåˆ’åˆ†

#### é˜¶æ®µ 1: åç«¯åŸºç¡€è®¾æ–½ (1 å‘¨)

**ç›®æ ‡**: æ­å»º HTTP æœåŠ¡å™¨å’Œ SSE äº‹ä»¶æµ

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `packages/coding-agent/src/modes/web/` ç›®å½•
- [ ] å®‰è£… Hono ä¾èµ–
- [ ] å®ç° `WebServer` ç±»
- [ ] å®ç° SSE äº‹ä»¶æµ
- [ ] å®ç°å¥åº·æ£€æŸ¥ç«¯ç‚¹
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

**äº¤ä»˜ç‰©**:
- å¯è¿è¡Œçš„ HTTP æœåŠ¡å™¨
- SSE äº‹ä»¶æµæ­£å¸¸å·¥ä½œ
- å¥åº·æ£€æŸ¥ç«¯ç‚¹å“åº”æ­£å¸¸

**éªŒæ”¶æ ‡å‡†**:
```bash
# å¯åŠ¨æœåŠ¡å™¨
pi --mode web --port 3721

# å¥åº·æ£€æŸ¥
curl http://localhost:3721/global/health
# é¢„æœŸ: {"status":"ok","version":"0.45.0"}

# SSE è¿æ¥
curl -N http://localhost:3721/global/event
# é¢„æœŸ: æŒç»­æ¥æ”¶ ping äº‹ä»¶
```

---

#### é˜¶æ®µ 2: åç«¯ API å¼€å‘ (1 å‘¨)

**ç›®æ ‡**: å®ç°æ‰€æœ‰ REST API ç«¯ç‚¹

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°ä¼šè¯ç®¡ç† API (`/sessions/*`)
- [ ] å®ç°æ¶ˆæ¯ API (`/sessions/:id/messages`)
- [ ] å®ç°å·¥å…· API (`/tools/*`)
- [ ] å®ç°æ–‡ä»¶æ“ä½œ API (`/file/*`)
- [ ] æ·»åŠ  CORS æ”¯æŒ
- [ ] æ·»åŠ é”™è¯¯å¤„ç†
- [ ] ç¼–å†™ API æµ‹è¯•

**äº¤ä»˜ç‰©**:
- å®Œæ•´çš„ REST API
- API æ–‡æ¡£
- æµ‹è¯•è¦†ç›–ç‡ > 80%

**éªŒæ”¶æ ‡å‡†**:
```bash
# åˆ›å»ºä¼šè¯
curl -X POST http://localhost:3721/sessions
# é¢„æœŸ: è¿”å›ä¼šè¯ ID

# å‘é€æ¶ˆæ¯
curl -X POST http://localhost:3721/sessions/{id}/messages \
  -H "Content-Type: application/json" \
  -d '{"message":"Hello"}'
# é¢„æœŸ: è¿”å›å“åº”

# åˆ—å‡ºæ–‡ä»¶
curl "http://localhost:3721/file?path=./"
# é¢„æœŸ: è¿”å›æ–‡ä»¶åˆ—è¡¨
```

---

#### é˜¶æ®µ 3: å‰ç«¯é¡¹ç›®æ­å»º (3 å¤©)

**ç›®æ ‡**: åˆ›å»ºå‰ç«¯åº”ç”¨åŸºç¡€ç»“æ„

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»º `packages/web-ui-app/` åŒ…
- [ ] å®‰è£… SolidJS + Vite ä¾èµ–
- [ ] é…ç½® TypeScript
- [ ] é…ç½® Tailwind CSS
- [ ] é…ç½® Vite æ„å»ºå·¥å…·
- [ ] åˆ›å»ºåŸºç¡€è·¯ç”±ç»“æ„
- [ ] åˆ›å»ºåº”ç”¨å£³ç»„ä»¶

**äº¤ä»˜ç‰©**:
- å¯è¿è¡Œçš„ Vite å¼€å‘æœåŠ¡å™¨
- åŸºç¡€è·¯ç”±å·¥ä½œæ­£å¸¸
- Tailwind CSS æ ·å¼ç”Ÿæ•ˆ

**éªŒæ”¶æ ‡å‡†**:
```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cd packages/web-ui-app
bun run dev

# è®¿é—®
open http://localhost:5173
# é¢„æœŸ: æ˜¾ç¤ºåº”ç”¨å£³
```

---

#### é˜¶æ®µ 4: ServerContext å’Œäº‹ä»¶é€‚é… (3 å¤©)

**ç›®æ ‡**: å®ç° SSE è¿æ¥ç®¡ç†å’Œäº‹ä»¶é€‚é…

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `ServerContext`
- [ ] å®ç° SSE è¿æ¥ç®¡ç†
- [ ] å®ç°äº‹ä»¶é€‚é…å™¨
- [ ] å®ç°è‡ªåŠ¨é‡è¿æœºåˆ¶
- [ ] ç¼–å†™è¿æ¥çŠ¶æ€æµ‹è¯•

**äº¤ä»˜ç‰©**:
- SSE è¿æ¥ç¨³å®š
- è‡ªåŠ¨é‡è¿å·¥ä½œæ­£å¸¸
- äº‹ä»¶æ­£ç¡®æ˜ å°„åˆ° UI

**éªŒæ”¶æ ‡å‡†**:
- æ‰“å¼€æµè§ˆå™¨åè‡ªåŠ¨è¿æ¥ SSE
- æ–­çº¿åè‡ªåŠ¨é‡è¿
- æ§åˆ¶å°æ— é”™è¯¯

---

#### é˜¶æ®µ 5: å¸ƒå±€ç»„ä»¶å¼€å‘ (4 å¤©)

**ç›®æ ‡**: å®ç°å¸ƒå±€å’Œä¾§è¾¹æ 

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `AppShell` ç»„ä»¶
- [ ] å®ç° `Sidebar` ç»„ä»¶
- [ ] å®ç° `SidebarHeader` ç»„ä»¶
- [ ] å®ç° `SidebarItem` ç»„ä»¶
- [ ] å®ç°å“åº”å¼å¸ƒå±€
- [ ] æ·»åŠ æš—è‰²æ¨¡å¼æ”¯æŒ

**äº¤ä»˜ç‰©**:
- å®Œæ•´çš„å¸ƒå±€ç³»ç»Ÿ
- å“åº”å¼è®¾è®¡
- æš—è‰²æ¨¡å¼åˆ‡æ¢

**éªŒæ”¶æ ‡å‡†**:
- ä¾§è¾¹æ æ­£å¸¸æ˜¾ç¤º
- å“åº”å¼å¸ƒå±€åœ¨æ‰‹æœº/å¹³æ¿æ­£å¸¸
- æš—è‰²æ¨¡å¼åˆ‡æ¢æ­£å¸¸

---

#### é˜¶æ®µ 6: AgentInterface é›†æˆ (3 å¤©)

**ç›®æ ‡**: å¤ç”¨ç°æœ‰ AgentInterface ç»„ä»¶

**ä»»åŠ¡æ¸…å•**:
- [ ] é›†æˆ `@mariozechner/pi-web-ui`
- [ ] åˆ›å»º `ChatArea` ç»„ä»¶
- [ ] é€‚é… AgentInterface åˆ° SSE
- [ ] å®ç°æ¶ˆæ¯å‘é€
- [ ] å®ç°æµå¼æ¶ˆæ¯æ˜¾ç¤º
- [ ] å®ç°å·¥å…·è°ƒç”¨æ˜¾ç¤º

**äº¤ä»˜ç‰©**:
- èŠå¤©ç•Œé¢æ­£å¸¸å·¥ä½œ
- æ¶ˆæ¯å‘é€æˆåŠŸ
- æµå¼æ¶ˆæ¯æ˜¾ç¤ºæ­£å¸¸

**éªŒæ”¶æ ‡å‡†**:
- è¾“å…¥æ¶ˆæ¯åæŒ‰ Enter å‘é€
- æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º
- å·¥å…·è°ƒç”¨æ­£ç¡®æ¸²æŸ“

---

#### é˜¶æ®µ 7: FileTree ç»„ä»¶ (3 å¤©)

**ç›®æ ‡**: å®ç°æ–‡ä»¶æµè§ˆå™¨

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `FileTree` ç»„ä»¶
- [ ] å®ç°æ–‡ä»¶æ ‘å±•å¼€/æŠ˜å 
- [ ] å®ç°æ–‡ä»¶å›¾æ ‡
- [ ] å®ç°æ–‡ä»¶æœç´¢
- [ ] å®ç°æ–‡ä»¶é¢„è§ˆ
- [ ] é›†æˆåˆ°ä¸»ç•Œé¢

**äº¤ä»˜ç‰©**:
- æ–‡ä»¶æ ‘æ­£å¸¸æ˜¾ç¤º
- å±•å¼€/æŠ˜å å·¥ä½œæ­£å¸¸
- æ–‡ä»¶æœç´¢åŠŸèƒ½æ­£å¸¸

**éªŒæ”¶æ ‡å‡†**:
- æ˜¾ç¤ºé¡¹ç›®æ–‡ä»¶æ ‘
- ç‚¹å‡»å±•å¼€/æŠ˜å 
- æœç´¢æ¡†è¿‡æ»¤æ–‡ä»¶

---

#### é˜¶æ®µ 8: Terminal ç»„ä»¶ (2 å¤©)

**ç›®æ ‡**: å®ç°ç»ˆç«¯è¾“å‡ºæ˜¾ç¤º

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç° `Terminal` ç»„ä»¶
- [ ] å®ç°å‘½ä»¤è¾“å‡ºæ˜¾ç¤º
- [ ] å®ç°è¯­æ³•é«˜äº®
- [ ] å®ç°æ»šåŠ¨ç®¡ç†
- [ ] é›†æˆåˆ°ä¸»ç•Œé¢

**äº¤ä»˜ç‰©**:
- ç»ˆç«¯ç»„ä»¶æ­£å¸¸å·¥ä½œ
- å‘½ä»¤è¾“å‡ºæ­£ç¡®æ˜¾ç¤º
- è‡ªåŠ¨æ»šåŠ¨æ­£å¸¸

**éªŒæ”¶æ ‡å‡†**:
- æ‰§è¡Œ bash å‘½ä»¤åæ˜¾ç¤ºè¾“å‡º
- è¯­æ³•é«˜äº®æ­£å¸¸
- è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

---

#### é˜¶æ®µ 9: Dialogs é›†æˆ (2 å¤©)

**ç›®æ ‡**: é›†æˆç°æœ‰å¯¹è¯æ¡†ç»„ä»¶

**ä»»åŠ¡æ¸…å•**:
- [ ] é›†æˆ `SettingsDialog`
- [ ] é›†æˆ `SessionListDialog`
- [ ] é›†æˆ `ModelSelector`
- [ ] é›†æˆ `ApiKeyPromptDialog`
- [ ] æ·»åŠ å¿«æ·é”®æ”¯æŒ

**äº¤ä»˜ç‰©**:
- æ‰€æœ‰å¯¹è¯æ¡†æ­£å¸¸å·¥ä½œ
- å¿«æ·é”®è§¦å‘æ­£å¸¸

**éªŒæ”¶æ ‡å‡†**:
- ç‚¹å‡»è®¾ç½®æŒ‰é’®æ‰“å¼€å¯¹è¯æ¡†
- å¯¹è¯æ¡†åŠŸèƒ½æ­£å¸¸

---

#### é˜¶æ®µ 10: CLI é›†æˆ (2 å¤©)

**ç›®æ ‡**: å°† Web Server é›†æˆåˆ° CLI

**ä»»åŠ¡æ¸…å•**:
- [ ] ä¿®æ”¹ `packages/coding-agent/src/main.ts`
- [ ] æ·»åŠ  `--mode web` é€‰é¡¹
- [ ] æ·»åŠ  `--port` é€‰é¡¹
- [ ] æ·»åŠ  `--host` é€‰é¡¹
- [ ] æ·»åŠ  `--open` é€‰é¡¹ï¼ˆè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼‰
- [ ] æ›´æ–° CLI å¸®åŠ©æ–‡æ¡£

**äº¤ä»˜ç‰©**:
- CLI å¯åŠ¨ Web Server
- æ‰€æœ‰é€‰é¡¹æ­£å¸¸å·¥ä½œ

**éªŒæ”¶æ ‡å‡†**:
```bash
# å¯åŠ¨ Web æ¨¡å¼
pi --mode web --port 3721 --open

# é¢„æœŸ: æœåŠ¡å™¨å¯åŠ¨ï¼Œæµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€
```

---

#### é˜¶æ®µ 11: ä¼˜åŒ–å’Œæµ‹è¯• (3 å¤©)

**ç›®æ ‡**: æ€§èƒ½ä¼˜åŒ–å’Œå…¨é¢æµ‹è¯•

**ä»»åŠ¡æ¸…å•**:
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆSSE è¿æ¥ã€æ¶ˆæ¯æ¸²æŸ“ï¼‰
- [ ] å†…å­˜æ³„æ¼æ£€æŸ¥
- [ ] é”™è¯¯å¤„ç†å®Œå–„
- [ ] ç¼–å†™ E2E æµ‹è¯•
- [ ] ä¿®å¤å·²çŸ¥é—®é¢˜
- [ ] ä»£ç å®¡æŸ¥

**äº¤ä»˜ç‰©**:
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- E2E æµ‹è¯•é€šè¿‡
- ä»£ç å®¡æŸ¥å®Œæˆ

**éªŒæ”¶æ ‡å‡†**:
- æ— å†…å­˜æ³„æ¼
- E2E æµ‹è¯•å…¨éƒ¨é€šè¿‡
- æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

---

#### é˜¶æ®µ 12: æ–‡æ¡£å’Œå‘å¸ƒ (2 å¤©)

**ç›®æ ‡**: æ–‡æ¡£ç¼–å†™å’Œå‡†å¤‡å‘å¸ƒ

**ä»»åŠ¡æ¸…å•**:
- [ ] ç¼–å†™ç”¨æˆ·æ–‡æ¡£
- [ ] ç¼–å†™å¼€å‘è€…æ–‡æ¡£
- [ ] ç¼–å†™ API æ–‡æ¡£
- [ ] æ›´æ–° README
- [ ] å‡†å¤‡å‘å¸ƒè¯´æ˜
- [ ] åˆ›å»ºç¤ºä¾‹é¡¹ç›®

**äº¤ä»˜ç‰©**:
- å®Œæ•´çš„æ–‡æ¡£
- å‘å¸ƒè¯´æ˜
- ç¤ºä¾‹é¡¹ç›®

---

### æ—¶é—´çº¿

```
Week 1:  åç«¯åŸºç¡€è®¾æ–½ + API å¼€å‘
Week 2:  å‰ç«¯æ­å»º + ServerContext
Week 3:  å¸ƒå±€ç»„ä»¶ + AgentInterface é›†æˆ
Week 4:  FileTree + Terminal + Dialogs
Week 5:  CLI é›†æˆ + ä¼˜åŒ–æµ‹è¯•
Week 6:  æ–‡æ¡£ + å‘å¸ƒ

æ€»è®¡: 6 å‘¨
```

---

## API è®¾è®¡

### åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://localhost:3721`
- **åè®®**: HTTP/1.1
- **è®¤è¯**: å¯é€‰ API Key
- **CORS**: ä»…å…è®¸ localhost

### å…¨å±€ç«¯ç‚¹

#### å¥åº·æ£€æŸ¥

```http
GET /global/health
```

**å“åº”**:
```json
{
  "status": "ok",
  "version": "0.45.0"
}
```

#### SSE äº‹ä»¶æµ

```http
GET /global/event
```

**å“åº”**: Server-Sent Events æµ

**äº‹ä»¶ç±»å‹**:
```typescript
type ServerEvent =
  | { type: "server.connected", version: string }
  | { type: "ping" }
  | { type: "session.created", session: Session }
  | { type: "session.updated", session: Session }
  | { type: "session.deleted", sessionId: string }
  | { type: "message.created", message: AgentMessage }
  | { type: "message.updated", message: AgentMessage, delta: string }
  | { type: "tool.start", toolCall: ToolCall }
  | { type: "tool.end", toolCall: ToolCall, result: ToolResult }
  | { type: "state.update", state: AgentState };
```

---

### ä¼šè¯ç«¯ç‚¹

#### åˆ—å‡ºä¼šè¯

```http
GET /sessions
```

**å“åº”**:
```json
{
  "sessions": [
    {
      "id": "uuid",
      "title": "Session Title",
      "createdAt": "2025-01-17T00:00:00.000Z",
      "lastModified": "2025-01-17T01:00:00.000Z",
      "messageCount": 10,
      "model": {
        "id": "anthropic:claude-sonnet-4-5-20250929",
        "provider": "anthropic",
        "name": "Claude Sonnet 4.5"
      }
    }
  ]
}
```

#### è·å–å½“å‰ä¼šè¯

```http
GET /sessions/current
```

**å“åº”**:
```json
{
  "id": "uuid",
  "state": {
    "messages": [...],
    "model": {...},
    "thinkingLevel": "off",
    "isStreaming": false
  }
}
```

#### åˆ›å»ºæ–°ä¼šè¯

```http
POST /sessions
```

**è¯·æ±‚ä½“**:
```json
{
  "model": "anthropic:claude-sonnet-4-5-20250929",
  "systemPrompt": "You are a helpful assistant.",
  "thinkingLevel": "off"
}
```

**å“åº”**:
```json
{
  "id": "uuid",
  "state": {...}
}
```

#### Fork ä¼šè¯

```http
POST /sessions/:sessionId/fork
```

**å“åº”**:
```json
{
  "id": "new-uuid",
  "parentId": "old-uuid",
  "state": {...}
}
```

#### æ›´æ–°ä¼šè¯

```http
PATCH /sessions/:sessionId
```

**è¯·æ±‚ä½“**:
```json
{
  "title": "New Title",
  "model": "anthropic:claude-sonnet-4-5-20250929"
}
```

**å“åº”**:
```json
{
  "id": "uuid",
  "state": {...}
}
```

#### åˆ é™¤ä¼šè¯

```http
DELETE /sessions/:sessionId
```

**å“åº”**: `204 No Content`

---

### æ¶ˆæ¯ç«¯ç‚¹

#### å‘é€æ¶ˆæ¯

```http
POST /sessions/:sessionId/messages
```

**è¯·æ±‚ä½“**:
```json
{
  "message": "Hello, how are you?",
  "attachments": []
}
```

**å“åº”**:
```json
{
  "success": true,
  "messageId": "uuid"
}
```

#### æ‰§è¡Œå‘½ä»¤

```http
POST /sessions/:sessionId/commands
```

**è¯·æ±‚ä½“**:
```json
{
  "type": "abort"
}
```

**å“åº”**:
```json
{
  "success": true
}
```

#### æ‰§è¡Œ Bash

```http
POST /sessions/:sessionId/bash
```

**è¯·æ±‚ä½“**:
```json
{
  "command": "ls -la"
}
```

**å“åº”**:
```json
{
  "stdout": "...",
  "stderr": "",
  "exitCode": 0
}
```

---

### å·¥å…·ç«¯ç‚¹

#### åˆ—å‡ºå·¥å…·

```http
GET /tools
```

**å“åº”**:
```json
{
  "tools": [
    {
      "name": "bash",
      "label": "Bash",
      "description": "Execute bash commands",
      "parameters": {...}
    }
  ]
}
```

#### æ‰§è¡Œå·¥å…·

```http
POST /tools/:toolName
```

**è¯·æ±‚ä½“**:
```json
{
  "parameters": {
    "command": "ls -la"
  }
}
```

**å“åº”**:
```json
{
  "result": {...}
}
```

---

### æ–‡ä»¶ç«¯ç‚¹

#### åˆ—å‡ºæ–‡ä»¶

```http
GET /file?path=./
```

**å“åº”**:
```json
{
  "files": [
    {
      "name": "src",
      "type": "directory",
      "path": "./src"
    },
    {
      "name": "README.md",
      "type": "file",
      "path": "./README.md",
      "size": 1024
    }
  ]
}
```

#### è¯»å–æ–‡ä»¶

```http
GET /file/content?path=./README.md
```

**å“åº”**:
```json
{
  "content": "# README\n...",
  "encoding": "utf-8"
}
```

#### å†™å…¥æ–‡ä»¶

```http
PUT /file/content?path=./README.md
```

**è¯·æ±‚ä½“**:
```json
{
  "content": "New content"
}
```

**å“åº”**:
```json
{
  "success": true
}
```

#### Git çŠ¶æ€

```http
GET /file/status
```

**å“åº”**:
```json
{
  "branch": "main",
  "modified": ["src/app.ts"],
  "added": [],
  "deleted": [],
  "untracked": []
}
```

---

## ç»„ä»¶è®¾è®¡

### å‰ç«¯ç»„ä»¶æ¶æ„

```
App (æ ¹ç»„ä»¶)
â”œâ”€â”€ ServerProvider (Context)
â”œâ”€â”€ AppShell (å¸ƒå±€)
â”‚   â”œâ”€â”€ Sidebar
â”‚   â”‚   â”œâ”€â”€ SidebarHeader
â”‚   â”‚   â”œâ”€â”€ SessionList
â”‚   â”‚   â””â”€â”€ SettingsButton
â”‚   â””â”€â”€ MainArea
â”‚       â”œâ”€â”€ ChatArea
â”‚       â”‚   â””â”€â”€ AgentInterface (å¤ç”¨)
â”‚       â”œâ”€â”€ FileTree
â”‚       â””â”€â”€ Terminal
â””â”€â”€ Dialogs (å…¨å±€)
    â”œâ”€â”€ SettingsDialog (å¤ç”¨)
    â”œâ”€â”€ SessionListDialog (å¤ç”¨)
    â””â”€â”€ ModelSelector (å¤ç”¨)
```

### ç»„ä»¶æ¸…å•

#### æ–°å¢ç»„ä»¶

| ç»„ä»¶ | è¯´æ˜ | Props |
|------|------|-------|
| `AppShell` | åº”ç”¨å¸ƒå±€ | `children: JSX.Element` |
| `Sidebar` | ä¾§è¾¹æ  | - |
| `SidebarHeader` | ä¾§è¾¹æ å¤´éƒ¨ | `title: string` |
| `SidebarItem` | ä¾§è¾¹æ é¡¹ç›® | `icon: Icon, label: string, onClick: () => void` |
| `ChatArea` | èŠå¤©åŒºåŸŸ | - |
| `FileTree` | æ–‡ä»¶æ ‘ | `rootPath: string` |
| `Terminal` | ç»ˆç«¯ | - |
| `ServerProvider` | Server Context | `children: JSX.Element` |

#### å¤ç”¨ç»„ä»¶

| ç»„ä»¶ | æ¥æº | ç”¨é€” |
|------|------|------|
| `AgentInterface` | `@mariozechner/pi-web-ui` | èŠå¤©ç•Œé¢ |
| `SettingsDialog` | `@mariozechner/pi-web-ui` | è®¾ç½®å¯¹è¯æ¡† |
| `SessionListDialog` | `@mariozechner/pi-web-ui` | ä¼šè¯åˆ—è¡¨ |
| `ModelSelector` | `@mariozechner/pi-web-ui` | æ¨¡å‹é€‰æ‹©å™¨ |
| `ApiKeyPromptDialog` | `@mariozechner/pi-web-ui` | API Key æç¤º |

### Context è®¾è®¡

#### ServerContext

```typescript
interface ServerContextValue {
  // è¿æ¥çŠ¶æ€
  connected: Accessor<boolean>;
  connecting: Accessor<boolean>;
  error: Accessor<Error | null>;

  // äº‹ä»¶è®¢é˜…
  subscribe: (callback: (event: ServerEvent) => void) => () => void;

  // å‘é€å‘½ä»¤
  send: (command: RpcCommand) => Promise<RpcResponse>;

  // Fetch åŒ…è£…
  fetch: typeof fetch;
}
```

#### SessionContext

```typescript
interface SessionContextValue {
  // ä¼šè¯çŠ¶æ€
  session: Accessor<Session | null>;
  messages: Accessor<AgentMessage[]>;
  isStreaming: Accessor<boolean>;

  // ä¼šè¯æ“ä½œ
  sendMessage: (message: string, attachments?: Attachment[]) => Promise<void>;
  abort: () => void;
  fork: () => Promise<void>;

  // æ¨¡å‹æ“ä½œ
  setModel: (model: Model) => Promise<void>;
  setThinkingLevel: (level: ThinkingLevel) => Promise<void>;
}
```

#### FileContext

```typescript
interface FileContextValue {
  // æ–‡ä»¶çŠ¶æ€
  files: Accessor<FileNode[]>;
  currentPath: Accessor<string>;

  // æ–‡ä»¶æ“ä½œ
  listFiles: (path: string) => Promise<void>;
  readFile: (path: string) => Promise<string>;
  writeFile: (path: string, content: string) => Promise<void>;
  deleteFile: (path: string) => Promise<void>;
}
```

---

## å¼€å‘æŒ‡å—

### ç¯å¢ƒè®¾ç½®

#### å‰ç½®è¦æ±‚

- Node.js >= 18
- Bun >= 1.0
- Deno >= 2.0 (å¯é€‰)

#### å®‰è£…ä¾èµ–

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/badlogic/pi-mono
cd pi-mono

# å®‰è£…ä¾èµ–
bun install

# æ„å»ºç°æœ‰åŒ…
bun run build
```

#### å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨åç«¯ï¼ˆç»ˆç«¯ 1ï¼‰
bun run dev --mode web --port 3721

# å¯åŠ¨å‰ç«¯ï¼ˆç»ˆç«¯ 2ï¼‰
cd packages/web-ui-app
bun run dev

# è®¿é—®
open http://localhost:5173
```

### ä»£ç è§„èŒƒ

#### TypeScript

```typescript
// å¯ç”¨ä¸¥æ ¼æ¨¡å¼
{
  "compilerOptions": {
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitReturns": true
  }
}
```

#### ESLint

```bash
# æ£€æŸ¥ä»£ç 
bun run lint

# è‡ªåŠ¨ä¿®å¤
bun run lint:fix
```

#### Prettier

```bash
# æ ¼å¼åŒ–ä»£ç 
bun run format

# æ£€æŸ¥æ ¼å¼
bun run format:check
```

### æµ‹è¯•

#### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
bun run test

# ç›‘å¬æ¨¡å¼
bun run test:watch

# è¦†ç›–ç‡
bun run test:coverage
```

#### E2E æµ‹è¯•

```bash
# è¿è¡Œ E2E æµ‹è¯•
bun run test:e2e
```

### è°ƒè¯•

#### åç«¯è°ƒè¯•

```typescript
// packages/coding-agent/src/modes/web/server.ts
import { logger } from "../utils/logger";

export class WebServer {
  constructor(private session: AgentSession) {
    logger.info("Initializing WebServer", { session: session.id });
    // ...
  }
}
```

#### å‰ç«¯è°ƒè¯•

```typescript
// packages/web-ui-app/src/utils/logger.ts
export const logger = {
  info: (...args: any[]) => console.log("[INFO]", ...args),
  error: (...args: any[]) => console.error("[ERROR]", ...args),
  debug: (...args: any[]) => console.debug("[DEBUG]", ...args),
};
```

### å¸¸è§é—®é¢˜

#### Q: SSE è¿æ¥æ–­å¼€æ€ä¹ˆåŠï¼Ÿ

A: ServerContext ä¼šè‡ªåŠ¨é‡è¿ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é‡è¿æ—¥å¿—ã€‚

#### Q: å¦‚ä½•æ·»åŠ æ–°çš„å·¥å…·æ¸²æŸ“å™¨ï¼Ÿ

A: å‚è€ƒç°æœ‰ `@mariozechner/pi-web-ui` çš„å·¥å…·æ¸²æŸ“å™¨æ³¨å†Œæœºåˆ¶ã€‚

#### Q: å¦‚ä½•ä¿®æ”¹ç«¯å£ï¼Ÿ

A: ä½¿ç”¨ `--port` é€‰é¡¹ï¼š`pi --mode web --port 8080`

#### Q: å¦‚ä½•ç¦ç”¨ CORSï¼Ÿ

A: åœ¨ `server.ts` ä¸­ä¿®æ”¹ CORS é…ç½®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ä¿æŒå¯ç”¨ã€‚

---

## æµ‹è¯•è®¡åˆ’

### æµ‹è¯•ç±»å‹

| ç±»å‹ | å·¥å…· | è¦†ç›–ç‡ç›®æ ‡ |
|------|------|-----------|
| å•å…ƒæµ‹è¯• | Vitest | 80% |
| é›†æˆæµ‹è¯• | Vitest | 70% |
| E2E æµ‹è¯• | Playwright | ä¸»è¦æµç¨‹ 100% |

### æµ‹è¯•ç”¨ä¾‹

#### åç«¯æµ‹è¯•

```typescript
// packages/coding-agent/src/modes/web/server.test.ts
import { describe, it, expect } from "vitest";
import { WebServer } from "./server";

describe("WebServer", () => {
  it("should respond to health check", async () => {
    const server = new WebServer(mockSession);
    await server.start();
    const response = await fetch("http://localhost:3721/global/health");
    expect(response.status).toBe(200);
    await server.stop();
  });
});
```

#### å‰ç«¯æµ‹è¯•

```typescript
// packages/web-ui-app/src/context/server.test.ts
import { describe, it, expect } from "vitest";
import { renderHook } from "@solidjs/testing-library";
import { useServer } from "./server";

describe("useServer", () => {
  it("should connect to server", async () => {
    const { result } = renderHook(() => useServer());
    expect(result.connected()).toBe(true);
  });
});
```

#### E2E æµ‹è¯•

```typescript
// packages/web-ui-app/e2e/chat.spec.ts
import { test, expect } from "@playwright/test";

test("send message", async ({ page }) => {
  await page.goto("http://localhost:5173");
  await page.fill('textarea[placeholder*="Type"]', "Hello");
  await page.click('button[type="submit"]');
  await expect(page.locator(".message-content")).toContainText("Hello");
});
```

---

## éƒ¨ç½²æŒ‡å—

### æœ¬åœ°éƒ¨ç½²

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
cd packages/web-ui-app
bun run build

# å¯åŠ¨åç«¯
cd ../coding-agent
bun run build
bun run start --mode web --port 3721

# å¯åŠ¨å‰ç«¯ï¼ˆä½¿ç”¨ nginx æˆ–å…¶ä»–é™æ€æœåŠ¡å™¨ï¼‰
cd ../web-ui-app/dist
python -m http.server 5173
```

### Docker éƒ¨ç½²

```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package.json bun.lockb ./
RUN bun install

# å¤åˆ¶æºç 
COPY . .

# æ„å»º
RUN bun run build

# æš´éœ²ç«¯å£
EXPOSE 3721

# å¯åŠ¨
CMD ["bun", "run", "start", "--mode", "web"]
```

### Nginx é…ç½®

```nginx
server {
    listen 80;
    server_name localhost;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/pi-web-ui-app/dist;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://localhost:3721/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
    }

    # SSE ä»£ç†
    location /global/event {
        proxy_pass http://localhost:3721/global/event;
        proxy_buffering off;
        proxy_cache off;
        proxy_set_header Connection '';
        proxy_set_header Cache-Control 'no-cache';
    }
}
```

---

## é™„å½•

### A. å‚è€ƒèµ„æ–™

- [pi-mono GitHub](https://github.com/badlogic/pi-mono)
- [OpenCode GitHub](https://github.com/anomalyco/opencode)
- [Hono æ–‡æ¡£](https://hono.dev)
- [SolidJS æ–‡æ¡£](https://www.solidjs.com)
- [SSE è§„èŒƒ](https://html.spec.whatwg.org/multipage/server-sent-events.html)

### B. æœ¯è¯­è¡¨

| æœ¯è¯­ | è¯´æ˜ |
|------|------|
| Agent | AI ä»£ç†ï¼Œæ ¸å¿ƒä¼šè¯å¼•æ“ |
| AgentSession | Agent ä¼šè¯å®ä¾‹ |
| SSE | Server-Sent Eventsï¼ŒæœåŠ¡å™¨æ¨é€äº‹ä»¶ |
| Artifact | å·¥ä»¶ï¼ŒAI ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆHTML/SVG/Markdownï¼‰ |
| Tool | å·¥å…·ï¼ŒAgent å¯ä»¥æ‰§è¡Œçš„æ“ä½œ |
| LLM | Large Language Modelï¼Œå¤§è¯­è¨€æ¨¡å‹ |

### C. å˜æ›´æ—¥å¿—

#### v0.1.0 (è®¡åˆ’ä¸­)

- âœ… åŸºç¡€ HTTP æœåŠ¡å™¨
- âœ… SSE äº‹ä»¶æµ
- âœ… åŸºç¡€èŠå¤©ç•Œé¢
- âœ… æ–‡ä»¶æµè§ˆå™¨
- âœ… ç»ˆç«¯é›†æˆ
- âœ… ä¼šè¯ç®¡ç†

### D. è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

### E. è®¸å¯è¯

MIT License - è¯¦è§ LICENSE æ–‡ä»¶

---

## è”ç³»æ–¹å¼

- é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/badlogic/pi-mono/issues)
- è®¨è®º: [GitHub Discussions](https://github.com/badlogic/pi-mono/discussions)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-01-17
**ç»´æŠ¤è€…**: Pi Agent Team