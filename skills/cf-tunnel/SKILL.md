---
name: cf-tunnel
description: Cloudflare Tunnel ä¸€é”®ç®¡ç†å·¥å…·ï¼Œæ”¯æŒå¯åŠ¨ã€åœæ­¢ã€çŠ¶æ€æ£€æŸ¥ã€ç«¯å£è‡ªåŠ¨æ£€æµ‹ä¸å ç”¨å¤„ç†
---

# Cloudflare Tunnel ç®¡ç†æŠ€èƒ½

ä¸€é”®ç®¡ç† Cloudflare Tunnel å’Œæœ¬åœ° Web æœåŠ¡å™¨ï¼Œè‡ªåŠ¨æ£€æµ‹ç«¯å£å ç”¨å¹¶å¤„ç†ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ä¸€é”®å¯åŠ¨ï¼šåŒæ—¶å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨å’Œ Cloudflare Tunnel
- ä¸€é”®åœæ­¢ï¼šä¼˜é›…å…³é—­æ‰€æœ‰ç›¸å…³è¿›ç¨‹
- çŠ¶æ€æ£€æŸ¥ï¼šæŸ¥çœ‹è¿è¡ŒçŠ¶æ€å’Œè®¿é—®åœ°å€
- ç«¯å£æ£€æµ‹ï¼šè‡ªåŠ¨æ£€æµ‹ç«¯å£å ç”¨å¹¶æä¾›å¤„ç†é€‰é¡¹
- é…ç½®ç®¡ç†ï¼šè‡ªåŠ¨ç”Ÿæˆå’Œç»´æŠ¤é…ç½®æ–‡ä»¶

## å®‰è£…ä¾èµ–

```bash
# Cloudflaredï¼ˆå¦‚æœªå®‰è£…ï¼‰
wget -q https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb
sudo dpkg -i cloudflared-linux-amd64.deb
```

## ä½¿ç”¨æ–¹æ³•

### 1. åˆå§‹åŒ–é…ç½®ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

```bash
bun ~/.pi/agent/skills/cf-tunnel/scripts/init.ts
```

è¿™ä¼šï¼š
- ç™»å½• Cloudflare è´¦å·
- åˆ›å»º Tunnel
- é…ç½® DNS è®°å½•

### 2. ä¸€é”®å¯åŠ¨

```bash
# è‡ªåŠ¨åˆ†é…ç«¯å£ï¼ˆæ¨èï¼‰
bun ~/.pi/agent/skills/cf-tunnel/scripts/start.ts

# æŒ‡å®šç«¯å£ï¼ˆå¦‚æœè¢«å ç”¨ä¼šæç¤ºå¤„ç†ï¼‰
bun ~/.pi/agent/skills/cf-tunnel/scripts/start.ts --port 3000 --dir ./dist
```

**è‡ªåŠ¨ç«¯å£åˆ†é…:**
- é»˜è®¤è‡ªåŠ¨å¯»æ‰¾ 10000-65000 èŒƒå›´å†…çš„éšæœºå¯ç”¨ç«¯å£
- é¿å…ä¸å¸¸è§ç«¯å£ï¼ˆ8080, 3000 ç­‰ï¼‰å†²çª
- å¦‚æœæŒ‡å®šç«¯å£è¢«å ç”¨ï¼Œæä¾›ç»ˆæ­¢è¿›ç¨‹æˆ–è‡ªåŠ¨åˆ†é…å…¶ä»–ç«¯å£çš„é€‰é¡¹

### 3. æŸ¥çœ‹çŠ¶æ€

```bash
bun ~/.pi/agent/skills/cf-tunnel/scripts/status.ts
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸŸ¢ Web Server: running on port 8080 (tmux: cf-web)
ğŸŸ¢ Cloudflare Tunnel: running (tmux: cf-tunnel)
ğŸŒ Public URL: https://mysite.example.com
```

### 4. ä¸€é”®åœæ­¢

```bash
bun ~/.pi/agent/skills/cf-tunnel/scripts/stop.ts
```

### 5. ç«¯å£æ£€æµ‹ä¸å¤„ç†

```bash
bun ~/.pi/agent/skills/cf-tunnel/scripts/port-check.ts 8080
```

å¦‚æœç«¯å£è¢«å ç”¨ï¼Œä¼šæç¤ºï¼š
- ç»ˆæ­¢å ç”¨è¿›ç¨‹
- ä½¿ç”¨å…¶ä»–ç«¯å£
- æŸ¥çœ‹å ç”¨è¯¦æƒ…

## é…ç½®è¯´æ˜

é…ç½®æ–‡ä»¶ä½äº `~/.cf-tunnel/config.json`ï¼š

```json
{
  "tunnelId": "xxx-xxx-xxx",
  "tunnelName": "my-website",
  "hostname": "mysite.example.com",
  "localPort": 0,
  "webDir": "~/my-website",
  "tmux": {
    "webSession": "cf-web",
    "tunnelSession": "cf-tunnel"
  }
}
```

**é…ç½®è¯´æ˜:**
- `localPort`: æœ¬åœ°ç«¯å£ï¼Œè®¾ä¸º `0` è¡¨ç¤ºè‡ªåŠ¨åˆ†é… (10000-65000)

## å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `init.ts` | åˆå§‹åŒ–é…ç½® |
| `start.ts [--port] [--dir]` | å¯åŠ¨æœåŠ¡ |
| `stop.ts` | åœæ­¢æœåŠ¡ |
| `status.ts` | æŸ¥çœ‹çŠ¶æ€ |
| `port-check.ts [port]` | æ£€æµ‹ç«¯å£ |
| `restart.ts` | é‡å¯æœåŠ¡ |
| `logs.ts [--web \| --tunnel]` | æŸ¥çœ‹æ—¥å¿— |

## å·¥ä½œåŸç†

1. **tmux ä¼šè¯ç®¡ç†**ï¼šä½¿ç”¨ tmux åœ¨åå°è¿è¡ŒæœåŠ¡
2. **ç«¯å£æ£€æµ‹**ï¼šå¯åŠ¨å‰æ£€æŸ¥ç«¯å£å ç”¨
3. **ä¼˜é›…å…³é—­**ï¼šå‘é€ SIGTERM ä¿¡å·ï¼Œè¶…æ—¶å SIGKILL
4. **è‡ªåŠ¨é‡è¿**ï¼šCloudflare Tunnel è‡ªå¸¦æ–­çº¿é‡è¿

## åŠŸèƒ½äº®ç‚¹

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **è‡ªåŠ¨ç«¯å£åˆ†é…** | é»˜è®¤ä½¿ç”¨ 10000-65000 éšæœºå¯ç”¨ç«¯å£ï¼Œé¿å… 8080/3000 å†²çª |
| **ç«¯å£æ£€æµ‹** | å¯åŠ¨å‰è‡ªåŠ¨æ£€æµ‹å ç”¨ï¼Œæä¾›ç»ˆæ­¢/æ¢ç«¯å£/å–æ¶ˆé€‰é¡¹ |
| **æ™ºèƒ½å›é€€** | æŒ‡å®šç«¯å£è¢«å æ—¶å¯è‡ªåŠ¨å¯»æ‰¾å…¶ä»–å¯ç”¨ç«¯å£ |
| **ä¼˜é›…å…³é—­** | å…ˆ SIGTERMï¼Œè¶…æ—¶å SIGKILL |
| **ä¼šè¯ç®¡ç†** | ä½¿ç”¨ tmuxï¼Œå¯ attach æŸ¥çœ‹å®æ—¶æ—¥å¿— |
| **å¥åº·æ£€æŸ¥** | status å‘½ä»¤æ£€æŸ¥ tunnel è¿æ¥çŠ¶æ€ |
| **è¿›ç¨‹è¯†åˆ«** | æ˜¾ç¤ºå ç”¨ç«¯å£çš„è¿›ç¨‹ä¿¡æ¯å’Œå®Œæ•´å‘½ä»¤è¡Œ |
