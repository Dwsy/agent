// Auto-generated by scripts/embed-web.ts â€” do not edit manually.
export const WEB_ASSETS: Record<string, string> = {
  "index.html": "<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover\">\n  <title>pi-gateway</title>\n  <link rel=\"stylesheet\" href=\"/web/style.css\">\n  <!-- Material Design 3 -->\n  <link href=\"https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap\" rel=\"stylesheet\">\n  <link href=\"https://fonts.googleapis.com/icon?family=Material+Icons\" rel=\"stylesheet\">\n  <!-- Highlight.js theme -->\n  <link rel=\"stylesheet\" href=\"https://esm.sh/highlight.js@11.9.0/styles/github-dark.min.css\">\n  <script type=\"importmap\">\n  {\n    \"imports\": {\n      \"lit\": \"https://esm.sh/lit@3.1.0\",\n      \"lit/directives/unsafe-html.js\": \"https://esm.sh/lit@3.1.0/directives/unsafe-html.js\",\n      \"marked\": \"https://esm.sh/marked@12.0.0\",\n      \"highlight.js\": \"https://esm.sh/highlight.js@11.9.0\"\n    }\n  }\n  </script>\n</head>\n<body>\n  <gw-app></gw-app>\n  <script type=\"module\" src=\"/web/app.js\"></script>\n</body>\n</html>\n",
  "style.css": "/* pi-gateway â€” Global resets and design tokens */\n\n:root {\n  --bg-primary: #0d1117;\n  --bg-secondary: #161b22;\n  --bg-tertiary: #21262d;\n  --bg-hover: #30363d;\n  --border: #30362d;\n  --border-subtle: #21262d;\n  --text-primary: #e6edf3;\n  --text-secondary: #8b949e;\n  --text-muted: #484f58;\n  --accent: #58a6ff;\n  --accent-hover: #79c0ff;\n  --accent-muted: #1f6feb33;\n  --success: #3fb950;\n  --warning: #d29922;\n  --danger: #f85149;\n  --radius: 8px;\n  --radius-sm: 4px;\n  --font-mono: \"SF Mono\", \"Fira Code\", \"Cascadia Code\", Menlo, monospace;\n  --font-sans: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif;\n  --shadow: 0 2px 8px rgba(0,0,0,.3);\n  --transition: 150ms ease;\n}\n\n*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }\n\nhtml, body {\n  height: 100%;\n  height: 100dvh;\n  font-family: var(--font-sans);\n  font-size: 14px;\n  color: var(--text-primary);\n  background: var(--bg-primary);\n  -webkit-font-smoothing: antialiased;\n  -webkit-text-size-adjust: 100%;\n}\n\nbody { \n  overflow: hidden;\n  overscroll-behavior: none;\n}\n\n/* Scrollbar */\n::-webkit-scrollbar { width: 6px; height: 6px; }\n::-webkit-scrollbar-track { background: transparent; }\n::-webkit-scrollbar-thumb { background: var(--bg-hover); border-radius: 3px; }\n::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }\n\n/* Touch optimization */\n* {\n  -webkit-tap-highlight-color: transparent;\n  touch-action: manipulation;\n}\n\n/* Utility */\n.mono { font-family: var(--font-mono); font-size: 12px; }\n\n/* Thinking panel */\n.thinking-panel {\n  margin: 8px 0;\n  border: 1px solid var(--border-subtle);\n  border-radius: var(--radius);\n  overflow: hidden;\n}\n.thinking-panel summary {\n  padding: 6px 12px;\n  cursor: pointer;\n  color: var(--text-secondary);\n  font-size: 13px;\n  background: var(--bg-tertiary);\n  user-select: none;\n}\n.thinking-panel summary:hover { background: var(--bg-hover); }\n.thinking-panel .thinking-content {\n  padding: 8px 12px;\n  font-size: 13px;\n  color: var(--text-secondary);\n  border-top: 1px solid var(--border-subtle);\n}\n\n/* Tool call panel */\n.tool-call {\n  margin: 4px 0;\n  border: 1px solid var(--border-subtle);\n  border-radius: var(--radius-sm);\n  font-family: var(--font-mono);\n  font-size: 12px;\n}\n.tool-call summary {\n  padding: 4px 8px;\n  cursor: pointer;\n  color: var(--accent);\n  background: var(--bg-secondary);\n  user-select: none;\n}\n.tool-call summary:hover { background: var(--bg-tertiary); }\n.tool-call pre {\n  margin: 0;\n  padding: 8px;\n  font-size: 11px;\n  overflow-x: auto;\n  border-top: 1px solid var(--border-subtle);\n}\n\n/* Highlight.js overrides */\n.hljs { background: var(--bg-secondary) !important; }\n\n/* Mobile safe area support */\n@supports (padding: env(safe-area-inset-top)) {\n  body {\n    padding-top: env(safe-area-inset-top);\n    padding-bottom: env(safe-area-inset-bottom);\n    padding-left: env(safe-area-inset-left);\n    padding-right: env(safe-area-inset-right);\n  }\n}\n",
  "app.js": "/**\n * pi-gateway Web UI â€” Lit components, zero build.\n *\n * Architecture:\n *   gw-app           Root shell (sidebar + router)\n *     gw-chat        WebChat panel (messages, input, streaming)\n *     gw-sessions    Sessions list panel\n *     gw-plugins     Plugins list panel\n *     gw-health      Health/stats panel\n *\n * Communication: WebSocket to ws(s)://{host}:{port} using the\n * Gateway req/res/event protocol (aligned with OpenClaw).\n */\n\nimport { LitElement, html, css } from \"lit\";\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\nimport { marked } from \"marked\";\nimport hljs from \"highlight.js\";\n\n// Configure marked with highlight.js\nmarked.setOptions({\n  highlight(code, lang) {\n    if (lang && hljs.getLanguage(lang)) {\n      return hljs.highlight(code, { language: lang }).value;\n    }\n    return hljs.highlightAuto(code).value;\n  },\n  breaks: true,\n  gfm: true,\n});\n\n// ============================================================================\n// Markdown / HTML Renderer\n// ============================================================================\n\n/**\n * Convert markdown text to HTML using marked + highlight.js.\n * Handles thinking blocks (<think>) as collapsible panels.\n */\nfunction renderMarkdown(text) {\n  if (!text) return \"\";\n\n  // Extract and render <think> blocks as collapsible details\n  let processed = text.replace(\n    /<think>([\\s\\S]*?)<\\/think>/g,\n    (_m, content) => {\n      const trimmed = content.trim();\n      if (!trimmed) return \"\";\n      return `<details class=\"thinking-panel\"><summary>ðŸ’­ Thinking</summary><div class=\"thinking-content\">${marked.parse(trimmed)}</div></details>`;\n    }\n  );\n\n  // Render remaining markdown\n  return marked.parse(processed);\n}\n\n/**\n * Format tool call for display â€” collapsible details panel.\n */\nfunction renderToolCall(name, args) {\n  let summary = name;\n  if (args) {\n    switch (name) {\n      case \"read\":\n        summary = `read ${args.path || args.filePath || args.file || \"\"}`;\n        break;\n      case \"write\":\n        summary = `write ${args.path || args.filePath || args.file || \"\"}`;\n        break;\n      case \"edit\":\n      case \"multi_edit\":\n        summary = `${name} ${args.path || args.filePath || args.file || \"\"}`;\n        break;\n      case \"bash\":\n        summary = `bash ${(args.command || args.cmd || \"\").slice(0, 120)}`;\n        break;\n      default: {\n        const payload = JSON.stringify(args);\n        summary = payload.length > 120 ? `${name} ${payload.slice(0, 120)}...` : `${name} ${payload}`;\n      }\n    }\n  }\n  const argsHtml = args ? `<pre><code>${JSON.stringify(args, null, 2)}</code></pre>` : \"\";\n  return `<details class=\"tool-call\"><summary>â†’ ${summary}</summary>${argsHtml}</details>`;\n}\n\n/**\n * Check if text contains HTML tags\n */\nfunction containsHtml(text) {\n  return /<[a-z][\\s\\S]*>/i.test(text);\n}\n\n/**\n * Render message content (auto-detect markdown or HTML)\n */\nfunction renderMessageContent(text) {\n  if (!text) return html``;\n\n  // If already HTML (from Telegram), use directly\n  if (containsHtml(text)) {\n    return unsafeHTML(text);\n  }\n\n  // Otherwise, render markdown\n  return unsafeHTML(renderMarkdown(text));\n}\n\n// ============================================================================\n// WebSocket Connection Manager\n// ============================================================================\n\nclass GatewayConnection {\n  constructor() {\n    this.ws = null;\n    this.reqId = 0;\n    this.pending = new Map();\n    this.listeners = new Map();\n    this.connected = false;\n    this.onStatusChange = () => {};\n  }\n\n  connect(url) {\n    if (this.ws) this.ws.close();\n\n    this.ws = new WebSocket(url);\n\n    this.ws.onopen = () => {\n      this.connected = true;\n      this.onStatusChange(true);\n      this.request(\"connect\", {}).catch(() => {});\n    };\n\n    this.ws.onclose = () => {\n      this.connected = false;\n      this.onStatusChange(false);\n      setTimeout(() => this.connect(url), 3000);\n    };\n\n    this.ws.onerror = () => {};\n\n    this.ws.onmessage = (e) => {\n      try {\n        const frame = JSON.parse(e.data);\n        if (frame.type === \"res\" && this.pending.has(frame.id)) {\n          const { resolve, reject } = this.pending.get(frame.id);\n          this.pending.delete(frame.id);\n          frame.ok ? resolve(frame.payload) : reject(new Error(frame.error));\n        } else if (frame.type === \"event\") {\n          const handlers = this.listeners.get(frame.event) || [];\n          handlers.forEach((h) => h(frame.payload));\n        }\n      } catch {}\n    };\n  }\n\n  request(method, params = {}) {\n    return new Promise((resolve, reject) => {\n      if (!this.ws || this.ws.readyState !== WebSocket.OPEN) {\n        return reject(new Error(\"Not connected\"));\n      }\n      const id = `ui-${++this.reqId}`;\n      this.pending.set(id, { resolve, reject });\n      setTimeout(() => {\n        if (this.pending.has(id)) {\n          this.pending.delete(id);\n          reject(new Error(\"Timeout\"));\n        }\n      }, 30000);\n      this.ws.send(JSON.stringify({ type: \"req\", id, method, params }));\n    });\n  }\n\n  on(event, handler) {\n    if (!this.listeners.has(event)) this.listeners.set(event, []);\n    this.listeners.get(event).push(handler);\n    return () => {\n      const arr = this.listeners.get(event);\n      if (arr) this.listeners.set(event, arr.filter((h) => h !== handler));\n    };\n  }\n}\n\nconst gw = new GatewayConnection();\n\n// ============================================================================\n// gw-app â€” Root Application Shell\n// ============================================================================\n\nclass GwApp extends LitElement {\n  static properties = {\n    activeTab: { type: String },\n    connected: { type: Boolean },\n    isMobile: { type: Boolean },\n  };\n\n  static styles = css`\n    :host {\n      display: flex;\n      height: 100vh;\n      height: 100dvh;\n      width: 100vw;\n      overflow: hidden;\n    }\n\n    .app-container {\n      display: flex;\n      width: 100%;\n      height: 100%;\n    }\n\n    nav {\n      width: 220px;\n      min-width: 220px;\n      background: var(--bg-secondary);\n      border-right: 1px solid var(--border);\n      display: flex;\n      flex-direction: column;\n      padding: 16px 0;\n    }\n\n    nav.mobile {\n      position: fixed;\n      bottom: 0;\n      left: 0;\n      right: 0;\n      width: 100%;\n      height: auto;\n      max-height: 60px;\n      flex-direction: row !important;\n      justify-content: space-around;\n      padding: 8px 0;\n      border-top: 1px solid var(--border);\n      border-right: none;\n      z-index: 100;\n      background: var(--bg-secondary);\n    }\n\n    .status-bar {\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      height: 56px;\n      padding: 0 16px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      background: var(--bg-secondary);\n      border-bottom: 1px solid var(--border);\n      z-index: 100;\n    }\n\n    .status-bar .title {\n      font-size: 18px;\n      font-weight: 600;\n      color: var(--text-primary);\n    }\n\n    /* Mobile styles */\n    @media (max-width: 768px) {\n      .app-container {\n        flex-direction: column;\n        padding-top: 56px;\n        padding-bottom: 60px;\n      }\n\n      nav.mobile .nav-items {\n        flex-direction: row;\n        display: flex;\n        width: 100%;\n        justify-content: space-around;\n        padding: 0;\n      }\n\n      nav.mobile .nav-item {\n        flex: 1;\n        flex-direction: column;\n        align-items: center;\n        padding: 4px;\n        font-size: 12px;\n        border-left: none;\n        gap: 2px;\n      }\n\n      nav.mobile .nav-item .icon {\n        font-size: 20px;\n      }\n\n      nav.mobile .nav-item .label {\n        font-size: 10px;\n      }\n\n      nav.mobile .nav-footer {\n        display: none;\n      }\n\n      main {\n        height: calc(100dvh - 56px - 60px);\n      }\n    }\n\n    .nav-header {\n      padding: 0 16px 16px;\n      border-bottom: 1px solid var(--border-subtle);\n      display: flex;\n      align-items: center;\n      gap: 8px;\n    }\n\n    .nav-header h1 {\n      font-size: 16px;\n      font-weight: 600;\n      color: var(--text-primary);\n    }\n\n    .dot {\n      width: 8px; height: 8px;\n      border-radius: 50%;\n      background: var(--danger);\n      transition: background var(--transition);\n    }\n    .dot.on { background: var(--success); }\n\n    .nav-items {\n      list-style: none;\n      padding: 8px 0;\n      flex: 1;\n    }\n\n    .nav-item {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      padding: 8px 16px;\n      cursor: pointer;\n      color: var(--text-secondary);\n      transition: all var(--transition);\n      font-size: 13px;\n      border-left: 2px solid transparent;\n    }\n\n    .nav-item:hover {\n      background: var(--bg-hover);\n      color: var(--text-primary);\n    }\n\n    .nav-item.active {\n      color: var(--accent);\n      border-left-color: var(--accent);\n      background: var(--accent-muted);\n    }\n\n    .nav-footer {\n      padding: 12px 16px;\n      border-top: 1px solid var(--border-subtle);\n      font-size: 11px;\n      color: var(--text-muted);\n    }\n\n    main {\n      flex: 1;\n      overflow: hidden;\n      display: flex;\n      flex-direction: column;\n    }\n  `;\n\n  constructor() {\n    super();\n    this.activeTab = \"chat\";\n    this.connected = false;\n    this.isMobile = window.matchMedia(\"(max-width: 768px)\").matches;\n    this.touchStartX = 0;\n    this.touchStartY = 0;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    gw.onStatusChange = (c) => { this.connected = c; };\n    if (!gw.ws) {\n      const protocol = location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n      gw.connect(`${protocol}//${location.host}`);\n    } else if (gw.connected) {\n      this.connected = true;\n    }\n\n    // Mobile detection\n    const mql = window.matchMedia(\"(max-width: 768px)\");\n    mql.addEventListener(\"change\", (e) => {\n      this.isMobile = e.matches;\n      this.requestUpdate();\n    });\n\n    // Touch gesture support for mobile\n    this.addEventListener(\"touchstart\", this.handleTouchStart, { passive: true });\n    this.addEventListener(\"touchend\", this.handleTouchEnd, { passive: true });\n\n    // Prevent zoom on double tap\n    this.addEventListener(\"dblclick\", (e) => e.preventDefault());\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeEventListener(\"touchstart\", this.handleTouchStart);\n    this.removeEventListener(\"touchend\", this.handleTouchEnd);\n  }\n\n  handleTouchStart(e) {\n    this.touchStartX = e.touches[0].clientX;\n    this.touchStartY = e.touches[0].clientY;\n  }\n\n  handleTouchEnd(e) {\n    if (!this.isMobile) return;\n\n    const touchEndX = e.changedTouches[0].clientX;\n    const touchEndY = e.changedTouches[0].clientY;\n\n    const deltaX = touchEndX - this.touchStartX;\n    const deltaY = touchEndY - this.touchStartY;\n\n    // Horizontal swipe detection (minimum 50px)\n    if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {\n      const tabs = [\"chat\", \"sessions\", \"plugins\", \"health\"];\n      const currentIndex = tabs.indexOf(this.activeTab);\n\n      if (deltaX < 0 && currentIndex < tabs.length - 1) {\n        // Swipe left -> next tab\n        this.switchTab(tabs[currentIndex + 1]);\n      } else if (deltaX > 0 && currentIndex > 0) {\n        // Swipe right -> previous tab\n        this.switchTab(tabs[currentIndex - 1]);\n      }\n    }\n  }\n\n  switchTab(tab) {\n    this.activeTab = tab;\n  }\n\n  _handleSessionSelect(session) {\n    this.switchTab(\"chat\");\n    const chat = this.renderRoot.querySelector(\"gw-chat\");\n    if (chat && chat.loadSession) {\n      chat.loadSession(session.sessionKey);\n    }\n  }\n\n  render() {\n    const tabs = [\n      { id: \"chat\", label: \"Chat\", icon: \"ðŸ’¬\" },\n      { id: \"sessions\", label: \"Sessions\", icon: \"ðŸ“‹\" },\n      { id: \"plugins\", label: \"Plugins\", icon: \"ðŸ§©\" },\n      { id: \"health\", label: \"Health\", icon: \"ðŸ“Š\" },\n    ];\n\n    return html`\n      ${this.isMobile ? html`\n        <div class=\"status-bar\">\n          <span class=\"title\">pi-gateway</span>\n          <span class=\"dot ${this.connected ? \"on\" : \"\"}\"></span>\n        </div>\n      ` : \"\"}\n      <div class=\"app-container\">\n        <nav class=\"sidebar ${this.isMobile ? \"mobile\" : \"\"}\">\n          ${!this.isMobile ? html`\n            <div class=\"nav-header\">\n              <h1>pi-gateway</h1>\n              <span class=\"dot ${this.connected ? \"on\" : \"\"}\"></span>\n            </div>\n          ` : \"\"}\n          <ul class=\"nav-items\">\n            ${tabs.map((t) => html`\n              <li class=\"nav-item ${this.activeTab === t.id ? \"active\" : \"\"}\"\n                  @click=${() => this.switchTab(t.id)}>\n                <span class=\"icon\">${t.icon}</span>\n                <span class=\"label\">${t.label}</span>\n              </li>\n            `)}\n          </ul>\n          <div class=\"nav-footer\">v0.1.0</div>\n        </nav>\n        <main>\n          ${this.activeTab === \"chat\" ? html`<gw-chat .connection=${gw}></gw-chat>` : \"\"}\n          ${this.activeTab === \"sessions\" ? html`<gw-sessions .connection=${gw} .onSessionSelect=${(s) => this._handleSessionSelect(s)}></gw-sessions>` : \"\"}\n          ${this.activeTab === \"plugins\" ? html`<gw-plugins .connection=${gw}></gw-plugins>` : \"\"}\n          ${this.activeTab === \"health\" ? html`<gw-health .connection=${gw}></gw-health>` : \"\"}\n        </main>\n      </div>\n    `;\n  }\n}\ncustomElements.define(\"gw-app\", GwApp);\n\n// ============================================================================\n// gw-chat â€” WebChat Panel\n// ============================================================================\n\nclass GwChat extends LitElement {\n  static properties = {\n    connection: { type: Object },\n    messages: { type: Array },\n    inputText: { type: String },\n    isStreaming: { type: Boolean },\n    isTyping: { type: Boolean },\n    wsConnected: { type: Boolean },\n    sessionKey: { type: String },\n    _sidebarOpen: { type: Boolean, state: true },\n    _sessions: { type: Array, state: true },\n    _currentAgent: { type: String, state: true },\n    _availableRoles: { type: Array, state: true },\n    _currentRole: { type: String, state: true },\n  };\n\n  static styles = css`\n    :host {\n      display: flex;\n      height: 100%;\n    }\n\n    /* ---- Session Sidebar ---- */\n    .sidebar {\n      width: 260px;\n      min-width: 260px;\n      background: var(--bg-secondary);\n      border-right: 1px solid var(--border);\n      display: flex;\n      flex-direction: column;\n      transition: margin-left 0.2s ease;\n      overflow: hidden;\n    }\n    .sidebar.collapsed {\n      margin-left: -260px;\n    }\n    .sidebar-header {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      padding: 12px 14px;\n      border-bottom: 1px solid var(--border-subtle);\n    }\n    .sidebar-header h3 {\n      font-size: 13px;\n      font-weight: 600;\n      color: var(--text-primary);\n    }\n    .new-session-btn {\n      background: var(--accent);\n      color: #fff;\n      border: none;\n      border-radius: var(--radius-sm);\n      padding: 4px 10px;\n      font-size: 12px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      gap: 4px;\n      transition: background var(--transition);\n    }\n    .new-session-btn:hover { background: var(--accent-hover); }\n\n    .session-list {\n      flex: 1;\n      overflow-y: auto;\n      padding: 6px 0;\n    }\n    .session-item {\n      display: flex;\n      flex-direction: column;\n      padding: 10px 14px;\n      cursor: pointer;\n      border-left: 2px solid transparent;\n      transition: all var(--transition);\n    }\n    .session-item:hover { background: var(--bg-hover); }\n    .session-item.active {\n      background: var(--accent-muted);\n      border-left-color: var(--accent);\n    }\n    .session-item-title {\n      font-size: 13px;\n      color: var(--text-primary);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    .session-item-meta {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      margin-top: 3px;\n      font-size: 11px;\n      color: var(--text-muted);\n    }\n    .session-item-meta .badge {\n      font-size: 10px;\n      padding: 1px 5px;\n      border-radius: 3px;\n      background: var(--bg-tertiary);\n      color: var(--text-secondary);\n    }\n    .session-item-meta .badge.streaming {\n      background: rgba(63,185,80,.15);\n      color: var(--success);\n    }\n    .session-item-actions {\n      display: flex;\n      gap: 4px;\n      margin-top: 4px;\n      opacity: 0;\n      transition: opacity var(--transition);\n    }\n    .session-item:hover .session-item-actions { opacity: 1; }\n    .session-item-actions button {\n      background: transparent;\n      border: 1px solid var(--border);\n      color: var(--text-secondary);\n      font-size: 10px;\n      padding: 2px 6px;\n      border-radius: 3px;\n      cursor: pointer;\n    }\n    .session-item-actions button:hover { background: var(--bg-hover); color: var(--text-primary); }\n    .session-item-actions button.danger { color: var(--danger); border-color: var(--danger); }\n    .session-item-actions button.danger:hover { background: rgba(248,81,73,.1); }\n\n    .sidebar-empty {\n      padding: 20px 14px;\n      text-align: center;\n      color: var(--text-muted);\n      font-size: 12px;\n    }\n\n    /* ---- Chat Main ---- */\n    .chat-main {\n      flex: 1;\n      display: flex;\n      flex-direction: column;\n      min-width: 0;\n    }\n\n    /* ---- Chat Header ---- */\n    .chat-header {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      padding: 10px 16px;\n      border-bottom: 1px solid var(--border-subtle);\n      background: var(--bg-secondary);\n      min-height: 44px;\n    }\n    .toggle-sidebar {\n      background: transparent;\n      border: 1px solid var(--border);\n      color: var(--text-secondary);\n      width: 30px;\n      height: 30px;\n      border-radius: var(--radius-sm);\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 14px;\n      flex-shrink: 0;\n      transition: all var(--transition);\n    }\n    .toggle-sidebar:hover { background: var(--bg-hover); color: var(--text-primary); }\n    .chat-title {\n      flex: 1;\n      font-size: 13px;\n      font-weight: 500;\n      color: var(--text-primary);\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n    .agent-badge {\n      font-size: 11px;\n      padding: 2px 8px;\n      border-radius: 10px;\n      background: var(--accent-muted);\n      color: var(--accent);\n      white-space: nowrap;\n      flex-shrink: 0;\n    }\n    .role-select {\n      background: var(--bg-tertiary);\n      border: 1px solid var(--border);\n      color: var(--text-secondary);\n      font-size: 11px;\n      padding: 3px 6px;\n      border-radius: var(--radius-sm);\n      cursor: pointer;\n      outline: none;\n    }\n    .role-select:hover { border-color: var(--accent); }\n\n    /* ---- Mobile sidebar overlay ---- */\n    .sidebar-overlay {\n      display: none;\n    }\n    @media (max-width: 768px) {\n      .sidebar {\n        position: fixed;\n        top: 56px;\n        left: 0;\n        bottom: 60px;\n        z-index: 200;\n        width: 280px;\n        min-width: 280px;\n        transition: transform 0.2s ease;\n        transform: translateX(0);\n      }\n      .sidebar.collapsed {\n        margin-left: 0;\n        transform: translateX(-100%);\n      }\n      .sidebar-overlay {\n        display: block;\n        position: fixed;\n        inset: 0;\n        background: rgba(0,0,0,.5);\n        z-index: 199;\n      }\n      .sidebar-overlay.hidden { display: none; }\n    }\n\n    .messages {\n      flex: 1;\n      overflow-y: auto;\n      padding: 20px;\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    }\n\n    .welcome {\n      text-align: center;\n      margin: auto;\n      color: var(--text-secondary);\n    }\n    .welcome h2 { font-size: 20px; margin-bottom: 8px; color: var(--text-primary); }\n    .welcome p { font-size: 13px; }\n\n    .msg {\n      max-width: 80%;\n      padding: 10px 14px;\n      border-radius: var(--radius);\n      font-size: 14px;\n      line-height: 1.5;\n      white-space: pre-wrap;\n      word-break: break-word;\n    }\n\n    .msg.user {\n      align-self: flex-end;\n      background: var(--accent-muted);\n      color: var(--text-primary);\n      border: 1px solid rgba(88,166,255,.2);\n    }\n\n    .msg.assistant {\n      align-self: flex-start;\n      background: var(--bg-tertiary);\n      color: var(--text-primary);\n      border: 1px solid var(--border-subtle);\n    }\n\n    .msg.error {\n      background: rgba(248,81,73,.1);\n      border: 1px solid rgba(248,81,73,.3);\n      color: var(--danger);\n    }\n\n    /* Thinking collapsible panel (streaming) */\n    details.msg.thinking {\n      max-width: 80%;\n      align-self: flex-start;\n      background: transparent;\n      border: 1px solid var(--border);\n      border-radius: var(--radius);\n      padding: 0;\n      font-size: 13px;\n    }\n    details.msg.thinking summary {\n      padding: 8px 12px;\n      cursor: pointer;\n      user-select: none;\n      list-style: none;\n    }\n    details.msg.thinking summary::-webkit-details-marker { display: none; }\n    .thinking-indicator { color: var(--text-secondary); font-size: 12px; }\n    .thinking-content {\n      padding: 0 12px 10px;\n      color: var(--text-secondary);\n      font-size: 12px;\n      line-height: 1.5;\n      max-height: 200px;\n      overflow-y: auto;\n      border-top: 1px solid var(--border);\n    }\n\n    .msg code {\n      font-family: var(--font-mono);\n      font-size: 12px;\n      background: var(--bg-primary);\n      padding: 1px 4px;\n      border-radius: 3px;\n    }\n\n    .msg pre {\n      background: var(--bg-primary);\n      padding: 10px;\n      border-radius: var(--radius-sm);\n      overflow-x: auto;\n      margin: 8px 0;\n      font-family: var(--font-mono);\n      font-size: 12px;\n      line-height: 1.4;\n    }\n\n    .typing {\n      align-self: flex-start;\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      padding: 8px 14px;\n      color: var(--text-secondary);\n      font-size: 13px;\n    }\n\n    .typing-dots span {\n      display: inline-block;\n      width: 6px;\n      height: 6px;\n      border-radius: 50%;\n      background: var(--text-muted);\n      animation: blink 1.4s infinite both;\n    }\n    .typing-dots span:nth-child(2) { animation-delay: .2s; }\n    .typing-dots span:nth-child(3) { animation-delay: .4s; }\n\n    @keyframes blink {\n      0%, 80%, 100% { opacity: 0; }\n      40% { opacity: 1; }\n    }\n\n    /* Extension UI prompt */\n    .ext-ui {\n      margin: 0 20px;\n      padding: 14px;\n      background: var(--bg-secondary);\n      border: 1px solid var(--accent);\n      border-radius: var(--radius);\n      animation: slideUp 0.2s ease;\n    }\n    @keyframes slideUp {\n      from { opacity: 0; transform: translateY(8px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n    .ext-ui-title {\n      font-weight: 500;\n      font-size: 13px;\n      margin-bottom: 10px;\n      color: var(--accent);\n    }\n    .ext-ui-message {\n      font-size: 13px;\n      color: var(--text-secondary);\n      margin-bottom: 10px;\n    }\n    .ext-ui-options {\n      display: flex;\n      flex-direction: column;\n      gap: 6px;\n      margin-bottom: 10px;\n    }\n    .ext-ui-option {\n      background: var(--bg-primary);\n      border: 1px solid var(--border);\n      border-radius: var(--radius);\n      padding: 8px 12px;\n      color: var(--text-primary);\n      font-size: 13px;\n      cursor: pointer;\n      text-align: left;\n      transition: border-color 0.15s;\n    }\n    .ext-ui-option:hover {\n      border-color: var(--accent);\n    }\n    .ext-ui-hint {\n      display: block;\n      font-size: 11px;\n      color: var(--text-secondary);\n      margin-top: 2px;\n    }\n    .ext-ui-input {\n      width: 100%;\n      background: var(--bg-primary);\n      border: 1px solid var(--border);\n      border-radius: var(--radius);\n      color: var(--text-primary);\n      font-family: var(--font-mono, monospace);\n      font-size: 13px;\n      padding: 8px 10px;\n      resize: vertical;\n      min-height: 60px;\n      margin-bottom: 10px;\n      outline: none;\n      box-sizing: border-box;\n    }\n    .ext-ui-input:focus { border-color: var(--accent); }\n    .ext-ui-actions {\n      display: flex;\n      gap: 8px;\n      justify-content: flex-end;\n    }\n    .ext-ui-submit {\n      background: var(--accent);\n      color: white;\n      border: none;\n      border-radius: var(--radius);\n      padding: 6px 16px;\n      font-size: 13px;\n      cursor: pointer;\n    }\n    .ext-ui-cancel {\n      background: transparent;\n      color: var(--text-secondary);\n      border: 1px solid var(--border);\n      border-radius: var(--radius);\n      padding: 6px 16px;\n      font-size: 13px;\n      cursor: pointer;\n    }\n    .ext-ui-progress {\n      height: 4px;\n      background: var(--border);\n      border-radius: 2px;\n      overflow: hidden;\n      margin-bottom: 6px;\n    }\n    .ext-ui-progress-bar {\n      height: 100%;\n      background: var(--accent);\n      transition: width 0.3s ease;\n    }\n    .ext-ui-progress-text {\n      font-size: 12px;\n      color: var(--text-secondary);\n    }\n\n    /* Image preview bar */\n    .image-preview-bar {\n      display: flex;\n      gap: 8px;\n      padding: 8px 20px 0;\n      overflow-x: auto;\n    }\n    .image-preview {\n      position: relative;\n      flex-shrink: 0;\n    }\n    .image-preview img {\n      height: 60px;\n      border-radius: var(--radius);\n      border: 1px solid var(--border);\n      object-fit: cover;\n    }\n    .image-remove {\n      position: absolute;\n      top: -4px;\n      right: -4px;\n      width: 18px;\n      height: 18px;\n      border-radius: 50%;\n      background: var(--danger, #f85149);\n      color: white;\n      border: none;\n      font-size: 11px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      line-height: 1;\n    }\n\n    /* Message images */\n    .msg-images {\n      display: flex;\n      gap: 6px;\n      margin-bottom: 8px;\n      flex-wrap: wrap;\n    }\n    .msg-image {\n      max-width: 300px;\n      max-height: 200px;\n      border-radius: var(--radius);\n      object-fit: contain;\n      cursor: pointer;\n      transition: opacity var(--transition);\n    }\n    .msg-image:hover { opacity: 0.85; }\n\n    /* Media images from agent MEDIA: directives */\n    .media-images {\n      display: flex;\n      gap: 8px;\n      margin-top: 8px;\n      flex-wrap: wrap;\n    }\n    .media-img {\n      max-width: 400px;\n      max-height: 300px;\n      border-radius: var(--radius);\n      object-fit: contain;\n      cursor: pointer;\n      border: 1px solid var(--border-subtle);\n      transition: opacity var(--transition);\n    }\n    .media-img:hover { opacity: 0.85; }\n    .media-download {\n      display: inline-flex;\n      align-items: center;\n      gap: 4px;\n      padding: 6px 10px;\n      background: var(--bg-tertiary);\n      border: 1px solid var(--border);\n      border-radius: var(--radius-sm);\n      color: var(--accent);\n      font-size: 12px;\n      text-decoration: none;\n      margin-top: 6px;\n    }\n    .media-download:hover { background: var(--bg-hover); }\n\n    /* Lightbox overlay */\n    .lightbox {\n      position: fixed;\n      inset: 0;\n      z-index: 1000;\n      background: rgba(0,0,0,.85);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: zoom-out;\n      animation: fadeIn 0.15s ease;\n    }\n    @keyframes fadeIn {\n      from { opacity: 0; }\n      to { opacity: 1; }\n    }\n    .lightbox img {\n      max-width: 90vw;\n      max-height: 90vh;\n      object-fit: contain;\n      border-radius: var(--radius);\n      box-shadow: var(--shadow);\n    }\n\n    /* Attach button */\n    .attach-btn {\n      background: transparent;\n      border: none;\n      font-size: 18px;\n      cursor: pointer;\n      padding: 4px;\n      opacity: 0.6;\n      transition: opacity 0.15s;\n    }\n    .attach-btn:hover { opacity: 1; }\n\n    .input-area {\n      padding: 12px 20px 16px;\n      border-top: 1px solid var(--border);\n      background: var(--bg-secondary);\n    }\n\n    form {\n      display: flex;\n      gap: 8px;\n      align-items: flex-end;\n    }\n\n    textarea {\n      flex: 1;\n      background: var(--bg-primary);\n      border: 1px solid var(--border);\n      border-radius: var(--radius);\n      color: var(--text-primary);\n      font-family: var(--font-sans);\n      font-size: 14px;\n      padding: 10px 12px;\n      resize: none;\n      outline: none;\n      min-height: 40px;\n      max-height: 120px;\n      transition: border-color var(--transition);\n    }\n    textarea:focus { border-color: var(--accent); }\n    textarea::placeholder { color: var(--text-muted); }\n\n    button {\n      width: 40px;\n      height: 40px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: var(--accent);\n      border: none;\n      border-radius: var(--radius);\n      color: #fff;\n      cursor: pointer;\n      transition: background var(--transition);\n      flex-shrink: 0;\n    }\n    button:hover { background: var(--accent-hover); }\n    button.abort { background: var(--danger); }\n    button.abort:hover { background: #da3633; }\n    button:disabled { opacity: .4; cursor: default; }\n\n    /* Mobile responsive */\n    @media (max-width: 768px) {\n      :host {\n        height: calc(100dvh - 56px - 60px);\n      }\n\n      .messages {\n        padding: 12px;\n        gap: 8px;\n      }\n\n      .msg {\n        max-width: 85%;\n        padding: 10px 14px;\n        font-size: 15px;\n        line-height: 1.5;\n      }\n\n      .welcome {\n        padding: 0 20px;\n      }\n\n      .welcome h2 {\n        font-size: 18px;\n      }\n\n      .input-area {\n        position: fixed;\n        bottom: 60px;\n        left: 0;\n        right: 0;\n        padding: 12px;\n        background: var(--bg-primary);\n        z-index: 90;\n      }\n\n      form {\n        gap: 10px;\n      }\n\n      textarea {\n        font-size: 16px;\n        padding: 12px 16px;\n        border-radius: 20px;\n        min-height: 44px;\n      }\n\n      button {\n        width: 44px;\n        height: 44px;\n        border-radius: 50%;\n      }\n    }\n\n    @media (max-width: 375px) {\n      .msg {\n        max-width: 90%;\n        font-size: 14px;\n      }\n    }\n  `;\n\n  constructor() {\n    super();\n    this.messages = [];\n    this.inputText = \"\";\n    this.isStreaming = false;\n    this.isTyping = false;\n    this.wsConnected = false;\n    this.sessionKey = \"\";\n    this._sidebarOpen = false;\n    this._sessions = [];\n    this._currentAgent = \"\";\n    this._availableRoles = [];\n    this._currentRole = \"\";\n    this._unsubs = [];\n    this._connPoll = null;\n    this._gotStreamingDelta = false;\n    this._pendingUI = null;\n    this._thinkingText = \"\";\n    this._isThinking = false;\n    this._pendingImages = [];\n    this._lightboxSrc = null; // Lightbox image URL\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.wsConnected = gw.connected;\n    this._connPoll = setInterval(() => {\n      if (this.wsConnected !== gw.connected) {\n        this.wsConnected = gw.connected;\n        if (gw.connected) this._loadSessions();\n      }\n    }, 500);\n    // Load sessions and roles once connected\n    if (gw.connected) {\n      this._loadSessions();\n      this._loadRoles();\n    }\n    const origOnStatus = gw.onStatusChange;\n    gw.onStatusChange = (c) => {\n      origOnStatus(c);\n      if (c) { this._loadSessions(); this._loadRoles(); }\n    };\n    this._unsubs.push(\n      gw.on(\"chat.reply\", (p) => {\n        // Skip if we already displayed this via streaming events\n        if (!this._gotStreamingDelta) {\n          const msg = { role: \"assistant\", text: p.text };\n          if (p.images?.length) msg.mediaImages = p.images; // Signed URLs from backend\n          this.messages = [...this.messages, msg];\n          this._scrollBottom();\n        } else {\n          // Streaming already displayed text â€” but check for images from MEDIA directives\n          if (p.images?.length) {\n            const last = this.messages[this.messages.length - 1];\n            if (last && (last.role === \"assistant\" || last.role === \"streaming\")) {\n              last.role = \"assistant\";\n              last.mediaImages = p.images;\n              this.messages = [...this.messages];\n            }\n          }\n        }\n        this._gotStreamingDelta = false;\n        this.isStreaming = false;\n        this.isTyping = false;\n      }),\n      gw.on(\"chat.typing\", (p) => {\n        this.isTyping = p.typing;\n      }),\n      gw.on(\"agent\", (p) => {\n        // Handle streaming text_delta and thinking events for real-time display\n        const ame = p.assistantMessageEvent;\n        if (p.type === \"message_update\" && ame) {\n          const isTextDelta = ame.type === \"text_delta\" && ame.delta;\n          const isThinkingStart = ame.type === \"thinking_start\";\n          const isThinkingDelta = ame.type === \"thinking_delta\" && ame.delta;\n          const isThinkingEnd = ame.type === \"thinking_end\";\n          const isToolStart = ame.type === \"tool_use\" && ame.name;\n\n          // Tool call: render as collapsible panel\n          if (isToolStart) {\n            const toolHtml = renderToolCall(ame.name, ame.input);\n            const last = this.messages[this.messages.length - 1];\n            if (last?.role === \"streaming\") {\n              last.text += \"\\n\" + toolHtml;\n              this.messages = [...this.messages];\n            } else {\n              this.messages = [...this.messages, { role: \"streaming\", text: toolHtml }];\n            }\n            this._scrollBottom();\n            return;\n          }\n\n          // Thinking: track separately, render as collapsible panel\n          if (isThinkingStart) {\n            this._isThinking = true;\n            this._thinkingText = \"\";\n            this._updateThinkingMessage();\n            this._scrollBottom();\n            return;\n          }\n          if (isThinkingDelta) {\n            this._thinkingText += ame.delta;\n            this._updateThinkingMessage();\n            this._scrollBottom();\n            return;\n          }\n          if (isThinkingEnd) {\n            this._isThinking = false;\n            this._updateThinkingMessage();\n            return;\n          }\n\n          // Text delta: append to streaming message\n          if (isTextDelta) {\n            this._gotStreamingDelta = true;\n            const last = this.messages[this.messages.length - 1];\n\n            if (last?.role === \"streaming\") {\n              last.text += ame.delta;\n              this.messages = [...this.messages];\n            } else {\n              this.messages = [...this.messages, { role: \"streaming\", text: ame.delta }];\n            }\n            this.isTyping = false;\n            this._scrollBottom();\n          }\n        }\n        if (p.type === \"agent_end\") {\n          // Convert streaming message to final assistant message\n          const last = this.messages[this.messages.length - 1];\n          if (last?.role === \"streaming\") {\n            last.role = \"assistant\";\n            this.messages = [...this.messages];\n          }\n          // Finalize thinking panel\n          this._isThinking = false;\n          this._thinkingText = \"\";\n          this.isStreaming = false;\n          this.isTyping = false;\n        }\n      }),\n      // Extension UI: prompt forwarded from agent\n      gw.on(\"extension_ui_request\", (p) => {\n        this._pendingUI = p;\n        this.requestUpdate();\n        this._scrollBottom();\n      }),\n      // Extension UI: prompt resolved by another client\n      gw.on(\"extension_ui_dismissed\", (p) => {\n        if (this._pendingUI?.id === p.id) {\n          this._pendingUI = null;\n          this.requestUpdate();\n        }\n      }),\n      // Media push from send_media API\n      gw.on(\"media_event\", (p) => {\n        if (p.sessionKey && p.sessionKey !== this.sessionKey) return;\n        const isImage = [\"photo\", \"image\"].includes(p.type) || /\\.(png|jpe?g|gif|webp|svg|bmp)$/i.test(p.filename || \"\");\n        if (isImage && p.url) {\n          // Append to last assistant message or create new one\n          const last = this.messages[this.messages.length - 1];\n          if (last && (last.role === \"assistant\" || last.role === \"streaming\")) {\n            last.mediaImages = [...(last.mediaImages || []), p.url];\n            this.messages = [...this.messages];\n          } else {\n            this.messages = [...this.messages, { role: \"assistant\", text: p.caption || \"\", mediaImages: [p.url] }];\n          }\n        } else if (p.url) {\n          // Non-image file: render as download link\n          const label = p.caption || p.filename || \"Download\";\n          const link = `[ðŸ“Ž ${label}](${p.url})`;\n          this.messages = [...this.messages, { role: \"assistant\", text: link }];\n        }\n        this._scrollBottom();\n      }),\n      // Agent-initiated text messages via send_message tool (v3.4 T1)\n      gw.on(\"message_event\", (p) => {\n        if (p.sessionKey && p.sessionKey !== this.sessionKey) return;\n        if (p.type === \"text\" && p.text) {\n          this.messages = [...this.messages, { role: \"assistant\", text: p.text }];\n          this._scrollBottom();\n        }\n      }),\n    );\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    this._unsubs.forEach((u) => u());\n    if (this._connPoll) clearInterval(this._connPoll);\n  }\n\n  async loadSession(sessionKey) {\n    if (!sessionKey) return;\n    this.sessionKey = sessionKey;\n    // Parse agent from session key (agent:{agentId}:{channel}:{scope}:{id})\n    const parts = sessionKey.split(\":\");\n    this._currentAgent = parts.length >= 2 ? parts[1] : \"\";\n    this._currentRole = \"\";\n    // Try to get role from session state\n    try {\n      const state = await gw.request(\"sessions.get\", { sessionKey });\n      if (state?.role) this._currentRole = state.role;\n    } catch {}\n    try {\n      const history = await gw.request(\"chat.history\", { sessionKey });\n      this.messages = (history?.messages || []).map((m) => ({\n        role: m.role,\n        text: m.content,\n        mediaImages: m.mediaImages || undefined,\n      }));\n      this._scrollBottom();\n    } catch (err) {\n      console.error(\"Failed to load session history:\", err);\n    }\n  }\n\n  async _loadSessions() {\n    try {\n      const list = await gw.request(\"sessions.list\");\n      this._sessions = (list || []).sort((a, b) => (b.lastActivity || 0) - (a.lastActivity || 0));\n    } catch {\n      this._sessions = [];\n    }\n  }\n\n  async _loadRoles() {\n    try {\n      const res = await gw.request(\"session.listRoles\");\n      this._availableRoles = res?.roles || [];\n    } catch {\n      this._availableRoles = [];\n    }\n  }\n\n  _newSession() {\n    // Generate a new webchat session key\n    const id = Date.now().toString(36) + Math.random().toString(36).slice(2, 6);\n    const agentId = this._currentAgent || \"main\";\n    const newKey = `agent:${agentId}:webchat:dm:${id}`;\n    this.sessionKey = newKey;\n    this.messages = [];\n    this._currentRole = \"\";\n    this._thinkingText = \"\";\n    this._isThinking = false;\n    this._gotStreamingDelta = false;\n    this.isStreaming = false;\n    this.isTyping = false;\n    this._sidebarOpen = false;\n    // Refresh session list after a short delay (session created on first message)\n    this.requestUpdate();\n  }\n\n  _selectSession(session) {\n    this.loadSession(session.sessionKey);\n    // Close sidebar on mobile\n    if (window.matchMedia(\"(max-width: 768px)\").matches) {\n      this._sidebarOpen = false;\n    }\n  }\n\n  async _deleteSession(sessionKey, ev) {\n    ev.stopPropagation();\n    try {\n      await gw.request(\"sessions.delete\", { sessionKey });\n      if (this.sessionKey === sessionKey) {\n        this.sessionKey = \"\";\n        this.messages = [];\n      }\n      this._loadSessions();\n    } catch (err) {\n      console.error(\"Failed to delete session:\", err);\n    }\n  }\n\n  async _changeRole(ev) {\n    const role = ev.target.value;\n    if (!role || !this.sessionKey) return;\n    try {\n      await gw.request(\"session.setRole\", { sessionKey: this.sessionKey, role });\n      this._currentRole = role;\n    } catch (err) {\n      console.error(\"Failed to set role:\", err);\n    }\n  }\n\n  _toggleSidebar() {\n    this._sidebarOpen = !this._sidebarOpen;\n    if (this._sidebarOpen) this._loadSessions();\n  }\n\n  _formatSessionTitle(session) {\n    const key = session.sessionKey || \"\";\n    // Extract meaningful parts: agent:main:webchat:dm:xxx -> \"webchat dm xxx\"\n    const parts = key.split(\":\");\n    if (parts.length >= 5) {\n      const agent = parts[1] === \"main\" ? \"\" : parts[1] + \" Â· \";\n      const channel = parts[2];\n      const id = parts.slice(4).join(\":\");\n      return `${agent}${channel} Â· ${id.slice(0, 8)}`;\n    }\n    return key.length > 30 ? key.slice(0, 30) + \"â€¦\" : key;\n  }\n\n  _formatTime(ts) {\n    if (!ts) return \"\";\n    const d = new Date(ts);\n    const now = new Date();\n    const diff = now - d;\n    if (diff < 60_000) return \"just now\";\n    if (diff < 3600_000) return `${Math.floor(diff / 60_000)}m ago`;\n    if (diff < 86400_000) return `${Math.floor(diff / 3600_000)}h ago`;\n    return d.toLocaleDateString();\n  }\n\n  _openLightbox(src) {\n    this._lightboxSrc = src;\n    this.requestUpdate();\n  }\n\n  _closeLightbox() {\n    this._lightboxSrc = null;\n    this.requestUpdate();\n  }\n\n  async _send(e) {\n    e.preventDefault();\n    const text = this.inputText.trim();\n    const images = this._pendingImages.length > 0 ? [...this._pendingImages] : undefined;\n    if ((!text && !images) || this.isStreaming) return;\n\n    // Show user message with image previews\n    const userMsg = { role: \"user\", text: text || \"(image)\", images };\n    this.messages = [...this.messages, userMsg];\n    this.inputText = \"\";\n    this._pendingImages = [];\n    this.requestUpdate();\n    this.isStreaming = true;\n    this.isTyping = true;\n    this._scrollBottom();\n\n    try {\n      const payload = { text: text || \"Describe this image.\" };\n      if (this.sessionKey) payload.sessionKey = this.sessionKey;\n      if (images) {\n        payload.images = images.map((img) => ({ data: img.data, mimeType: img.mimeType }));\n      }\n      await gw.request(\"chat.send\", payload);\n      // Refresh session list (new session may have been created)\n      setTimeout(() => this._loadSessions(), 500);\n    } catch (err) {\n      this.messages = [...this.messages, { role: \"error\", text: err.message }];\n      this.isStreaming = false;\n      this.isTyping = false;\n    }\n  }\n\n  async _abort() {\n    try {\n      await gw.request(\"chat.abort\", { sessionKey: this.sessionKey || undefined });\n    } catch {}\n    this.isStreaming = false;\n    this.isTyping = false;\n  }\n\n  async _respondUI(value, cancelled = false) {\n    if (!this._pendingUI) return;\n    const id = this._pendingUI.id;\n    try {\n      await gw.request(\"extension_ui_response\", {\n        id,\n        ...(cancelled ? { cancelled: true } : { value, confirmed: typeof value === \"boolean\" ? value : undefined }),\n      });\n    } catch (err) {\n      console.error(\"Extension UI response failed:\", err);\n    }\n    this._pendingUI = null;\n    this.requestUpdate();\n  }\n\n  _onKeydown(e) {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      this._send(e);\n    }\n  }\n\n  _onInput(e) {\n    this.inputText = e.target.value;\n    // Auto-resize\n    e.target.style.height = \"auto\";\n    e.target.style.height = Math.min(e.target.scrollHeight, 120) + \"px\";\n  }\n\n  _onPaste(e) {\n    const items = e.clipboardData?.items;\n    if (!items) return;\n    for (const item of items) {\n      if (item.type.startsWith(\"image/\")) {\n        e.preventDefault();\n        const file = item.getAsFile();\n        if (file) this._addImageFile(file);\n        return;\n      }\n    }\n  }\n\n  _onFileSelect(e) {\n    const files = e.target.files;\n    if (!files) return;\n    for (const file of files) {\n      if (file.type.startsWith(\"image/\")) {\n        this._addImageFile(file);\n      }\n    }\n    e.target.value = \"\";\n  }\n\n  _addImageFile(file) {\n    const reader = new FileReader();\n    reader.onload = () => {\n      const base64 = reader.result.split(\",\")[1];\n      this._pendingImages = [...this._pendingImages, {\n        data: base64,\n        mimeType: file.type,\n        name: file.name,\n        preview: reader.result, // data URL for preview\n      }];\n      this.requestUpdate();\n    };\n    reader.readAsDataURL(file);\n  }\n\n  _removeImage(index) {\n    this._pendingImages = this._pendingImages.filter((_, i) => i !== index);\n    this.requestUpdate();\n  }\n\n  _updateThinkingMessage() {\n    // Insert or update a \"thinking\" role message in the messages array\n    const last = this.messages[this.messages.length - 1];\n    if (last?.role === \"thinking\") {\n      last.text = this._thinkingText;\n      last.isThinking = this._isThinking;\n      this.messages = [...this.messages];\n    } else if (this._thinkingText || this._isThinking) {\n      this.messages = [...this.messages, { role: \"thinking\", text: this._thinkingText, isThinking: this._isThinking }];\n    }\n  }\n\n  _scrollBottom() {\n    requestAnimationFrame(() => {\n      const el = this.renderRoot.querySelector(\".messages\");\n      if (el) el.scrollTop = el.scrollHeight;\n    });\n  }\n\n  _renderExtensionUI() {\n    const ui = this._pendingUI;\n    if (!ui) return \"\";\n    const title = ui.title || \"Agent Request\";\n\n    switch (ui.method) {\n      case \"select\":\n      case \"multiselect\": {\n        const options = ui.options || [];\n        return html`\n          <div class=\"ext-ui\">\n            <div class=\"ext-ui-title\">${title}</div>\n            <div class=\"ext-ui-options\">\n              ${options.map((opt) => {\n                const label = typeof opt === \"string\" ? opt : opt.label;\n                const value = typeof opt === \"string\" ? opt : opt.value;\n                const hint = typeof opt === \"object\" ? opt.hint : null;\n                return html`\n                  <button class=\"ext-ui-option\" @click=${() => this._respondUI(value)}>\n                    ${label}${hint ? html`<span class=\"ext-ui-hint\">${hint}</span>` : \"\"}\n                  </button>\n                `;\n              })}\n            </div>\n            <button class=\"ext-ui-cancel\" @click=${() => this._respondUI(null, true)}>Cancel</button>\n          </div>\n        `;\n      }\n      case \"text\":\n      case \"editor\":\n        return html`\n          <div class=\"ext-ui\">\n            <div class=\"ext-ui-title\">${title}</div>\n            <textarea\n              class=\"ext-ui-input\"\n              placeholder=${ui.placeholder || \"\"}\n              .value=${ui.defaultValue || \"\"}\n              @keydown=${(e) => {\n                if (e.key === \"Enter\" && !e.shiftKey) {\n                  e.preventDefault();\n                  this._respondUI(e.target.value);\n                }\n              }}\n            ></textarea>\n            <div class=\"ext-ui-actions\">\n              <button class=\"ext-ui-submit\" @click=${(e) => {\n                const ta = this.renderRoot.querySelector(\".ext-ui-input\");\n                this._respondUI(ta?.value || \"\");\n              }}>Submit</button>\n              <button class=\"ext-ui-cancel\" @click=${() => this._respondUI(null, true)}>Cancel</button>\n            </div>\n          </div>\n        `;\n      case \"confirm\":\n        return html`\n          <div class=\"ext-ui\">\n            <div class=\"ext-ui-title\">${title}</div>\n            ${ui.message ? html`<div class=\"ext-ui-message\">${ui.message}</div>` : \"\"}\n            <div class=\"ext-ui-actions\">\n              <button class=\"ext-ui-submit\" @click=${() => this._respondUI(true)}>Yes</button>\n              <button class=\"ext-ui-cancel\" @click=${() => this._respondUI(false)}>No</button>\n            </div>\n          </div>\n        `;\n      case \"progress\":\n        return html`\n          <div class=\"ext-ui\">\n            <div class=\"ext-ui-title\">${ui.label || title}</div>\n            ${ui.total ? html`\n              <div class=\"ext-ui-progress\">\n                <div class=\"ext-ui-progress-bar\" style=\"width: ${Math.round(((ui.current || 0) / ui.total) * 100)}%\"></div>\n              </div>\n              <div class=\"ext-ui-progress-text\">${ui.current || 0} / ${ui.total}</div>\n            ` : html`<div class=\"ext-ui-progress-text\">Processing...</div>`}\n          </div>\n        `;\n      default:\n        return html`\n          <div class=\"ext-ui\">\n            <div class=\"ext-ui-title\">${title}</div>\n            <button class=\"ext-ui-cancel\" @click=${() => this._respondUI(null, true)}>Dismiss</button>\n          </div>\n        `;\n    }\n  }\n\n  render() {\n    const sessionTitle = this.sessionKey\n      ? this._formatSessionTitle({ sessionKey: this.sessionKey })\n      : \"New Chat\";\n\n    return html`\n      <!-- Sidebar overlay (mobile) -->\n      <div class=\"sidebar-overlay ${this._sidebarOpen ? \"\" : \"hidden\"}\"\n           @click=${() => { this._sidebarOpen = false; }}></div>\n\n      <!-- Session Sidebar -->\n      <aside class=\"sidebar ${this._sidebarOpen ? \"\" : \"collapsed\"}\">\n        <div class=\"sidebar-header\">\n          <h3>Sessions</h3>\n          <button class=\"new-session-btn\" @click=${() => this._newSession()}>+ New</button>\n        </div>\n        <div class=\"session-list\">\n          ${this._sessions.length === 0\n            ? html`<div class=\"sidebar-empty\">No sessions yet</div>`\n            : this._sessions.map((s) => html`\n              <div class=\"session-item ${s.sessionKey === this.sessionKey ? \"active\" : \"\"}\"\n                   @click=${() => this._selectSession(s)}>\n                <div class=\"session-item-title\">${this._formatSessionTitle(s)}</div>\n                <div class=\"session-item-meta\">\n                  <span>${s.messageCount ?? 0} msgs</span>\n                  <span>${this._formatTime(s.lastActivity)}</span>\n                  ${s.isStreaming ? html`<span class=\"badge streaming\">live</span>` : \"\"}\n                  ${s.role ? html`<span class=\"badge\">${s.role}</span>` : \"\"}\n                </div>\n                <div class=\"session-item-actions\">\n                  <button class=\"danger\" @click=${(e) => this._deleteSession(s.sessionKey, e)}>Delete</button>\n                </div>\n              </div>\n            `)}\n        </div>\n      </aside>\n\n      <!-- Chat Main -->\n      <div class=\"chat-main\">\n        <div class=\"chat-header\">\n          <button class=\"toggle-sidebar\" @click=${() => this._toggleSidebar()}\n                  title=\"Toggle sessions\">â˜°</button>\n          <span class=\"chat-title\">${sessionTitle}</span>\n          ${this._currentAgent && this._currentAgent !== \"main\"\n            ? html`<span class=\"agent-badge\">ðŸ¤– ${this._currentAgent}</span>`\n            : \"\"}\n          ${this._availableRoles.length > 1\n            ? html`<select class=\"role-select\" .value=${this._currentRole || \"default\"}\n                           @change=${this._changeRole}>\n                ${this._availableRoles.map((r) => html`<option value=${r} ?selected=${r === (this._currentRole || \"default\")}>${r}</option>`)}\n              </select>`\n            : \"\"}\n        </div>\n\n        <div class=\"messages\">\n          ${this.messages.length === 0\n            ? html`<div class=\"welcome\">\n                <h2>pi-gateway WebChat</h2>\n                <p>Type a message to chat with your pi agent.</p>\n              </div>`\n            : this.messages.map((m) => {\n                if (m.role === \"thinking\") {\n                  return html`\n                    <details class=\"msg thinking\" ?open=${m.isThinking}>\n                      <summary>\n                        ${m.isThinking ? html`<span class=\"thinking-indicator\">ðŸ’­ Thinking...</span>` : html`<span class=\"thinking-indicator\">ðŸ’­ Thought process</span>`}\n                      </summary>\n                      <div class=\"thinking-content\">${renderMessageContent(m.text)}</div>\n                    </details>\n                  `;\n                }\n                return html`\n                  <div class=\"msg ${m.role === \"streaming\" ? \"assistant\" : m.role}\">\n                    ${m.images?.length ? html`\n                      <div class=\"msg-images\">\n                        ${m.images.map((img) => html`<img src=${img.preview || `data:${img.mimeType};base64,${img.data}`} class=\"msg-image\" @click=${() => this._openLightbox(img.preview || `data:${img.mimeType};base64,${img.data}`)} />`)}\n                      </div>\n                    ` : \"\"}\n                    ${renderMessageContent(m.text)}\n                    ${m.mediaImages?.length ? html`\n                      <div class=\"media-images\">\n                        ${m.mediaImages.map((url) => html`<img src=${url} class=\"media-img\" @click=${() => this._openLightbox(url)} loading=\"lazy\" />`)}\n                      </div>\n                    ` : \"\"}\n                  </div>\n                `;\n              })}\n          ${this.isTyping && !this.messages.some((m) => m.role === \"streaming\")\n            ? html`<div class=\"typing\">\n                <span class=\"typing-dots\"><span></span><span></span><span></span></span>\n                Thinking...\n              </div>`\n            : \"\"}\n        </div>\n        ${this._pendingUI ? this._renderExtensionUI() : \"\"}\n        ${this._pendingImages.length > 0 ? html`\n          <div class=\"image-preview-bar\">\n            ${this._pendingImages.map((img, i) => html`\n              <div class=\"image-preview\">\n                <img src=${img.preview} alt=${img.name} />\n                <button class=\"image-remove\" @click=${() => this._removeImage(i)}>Ã—</button>\n              </div>\n            `)}\n          </div>\n        ` : \"\"}\n        <div class=\"input-area\">\n          <form @submit=${this._send}>\n            <input type=\"file\" accept=\"image/*\" multiple\n              style=\"display:none\" id=\"file-input\"\n              @change=${this._onFileSelect} />\n            <button type=\"button\" class=\"attach-btn\"\n              @click=${() => this.renderRoot.querySelector(\"#file-input\").click()}\n              title=\"Attach image\">ðŸ“Ž</button>\n            <textarea\n              .value=${this.inputText}\n              @input=${this._onInput}\n              @keydown=${this._onKeydown}\n              @paste=${this._onPaste}\n              placeholder=\"Type a message... (Enter to send)\"\n              rows=\"1\"\n              ?disabled=${!this.wsConnected}\n            ></textarea>\n            ${this.isStreaming\n              ? html`<button type=\"button\" class=\"abort\" @click=${this._abort} title=\"Abort\">â– </button>`\n              : html`<button type=\"submit\" ?disabled=${!this.inputText.trim() && !this._pendingImages.length || !this.wsConnected} title=\"Send\">âž¤</button>`}\n          </form>\n        </div>\n      </div>\n      ${this._lightboxSrc ? html`\n        <div class=\"lightbox\" @click=${() => this._closeLightbox()}>\n          <img src=${this._lightboxSrc} />\n        </div>\n      ` : \"\"}\n    `;\n  }\n}\ncustomElements.define(\"gw-chat\", GwChat);\n\n// ============================================================================\n// gw-sessions â€” Sessions Admin Panel\n// ============================================================================\n\nclass GwSessions extends LitElement {\n  static properties = {\n    sessions: { type: Array },\n    loading: { type: Boolean },\n    onSessionSelect: { type: Function },\n  };\n\n  static styles = css`\n    :host {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      overflow-y: auto;\n      padding: 20px;\n    }\n\n    .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 16px;\n    }\n\n    h2 { font-size: 18px; font-weight: 600; }\n\n    button {\n      background: var(--bg-tertiary);\n      border: 1px solid var(--border);\n      color: var(--text-secondary);\n      padding: 6px 12px;\n      border-radius: var(--radius-sm);\n      cursor: pointer;\n      font-size: 12px;\n    }\n    button:hover { background: var(--bg-hover); color: var(--text-primary); }\n\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      font-size: 13px;\n    }\n\n    th {\n      text-align: left;\n      padding: 8px 12px;\n      border-bottom: 1px solid var(--border);\n      color: var(--text-secondary);\n      font-weight: 500;\n      font-size: 11px;\n      text-transform: uppercase;\n      letter-spacing: .5px;\n    }\n\n    td {\n      padding: 8px 12px;\n      border-bottom: 1px solid var(--border-subtle);\n      color: var(--text-primary);\n    }\n\n    .key { font-family: var(--font-mono); font-size: 11px; color: var(--accent); }\n    .badge {\n      display: inline-block;\n      padding: 2px 6px;\n      border-radius: 3px;\n      font-size: 11px;\n      font-weight: 500;\n    }\n    .badge.streaming { background: rgba(63,185,80,.15); color: var(--success); }\n    .badge.idle { background: var(--bg-tertiary); color: var(--text-secondary); }\n    .empty { color: var(--text-muted); text-align: center; padding: 40px; }\n\n    tr {\n      cursor: pointer;\n      transition: background var(--transition);\n    }\n    tr:hover { background: var(--bg-hover); }\n    tr.selected { background: var(--accent-muted); }\n\n    .actions {\n      display: flex;\n      gap: 8px;\n    }\n    .actions button {\n      padding: 4px 10px;\n      font-size: 11px;\n    }\n    .actions button.primary {\n      background: var(--accent);\n      color: #fff;\n      border-color: var(--accent);\n    }\n    .actions button.primary:hover {\n      background: var(--accent-hover);\n    }\n    .actions button.danger {\n      color: var(--danger);\n      border-color: var(--danger);\n    }\n    .actions button.danger:hover {\n      background: rgba(248,81,73,.1);\n    }\n  `;\n\n  constructor() {\n    super();\n    this.sessions = [];\n    this.loading = true;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._load();\n  }\n\n  async _load() {\n    this.loading = true;\n    try {\n      this.sessions = await gw.request(\"sessions.list\");\n    } catch {\n      this.sessions = [];\n    }\n    this.loading = false;\n  }\n\n  _selectSession(session) {\n    if (this.onSessionSelect) {\n      this.onSessionSelect(session);\n    }\n  }\n\n  async _resumeSession(sessionKey) {\n    try {\n      await gw.request(\"session.resume\", { sessionKey });\n      this._selectSession({ sessionKey });\n    } catch (err) {\n      console.error(\"Failed to resume session:\", err);\n    }\n  }\n\n  async _closeSession(sessionKey, ev) {\n    ev.stopPropagation();\n    try {\n      await gw.request(\"session.close\", { sessionKey });\n      this._load();\n    } catch (err) {\n      console.error(\"Failed to close session:\", err);\n    }\n  }\n\n  render() {\n    return html`\n      <div class=\"header\">\n        <h2>Active Sessions</h2>\n        <button @click=${() => this._load()}>Refresh</button>\n      </div>\n      ${this.sessions.length === 0\n        ? html`<div class=\"empty\">${this.loading ? \"Loading...\" : \"No active sessions\"}</div>`\n        : html`\n          <table>\n            <thead><tr>\n              <th>Session Key</th>\n              <th>Role</th>\n              <th>Messages</th>\n              <th>Status</th>\n              <th>Last Activity</th>\n            </tr></thead>\n            <tbody>\n              ${this.sessions.map((s) => html`\n                <tr @click=${() => this._selectSession(s)}>\n                  <td class=\"key\">${s.sessionKey}</td>\n                  <td>${s.role ?? \"default\"}</td>\n                  <td>${s.messageCount}</td>\n                  <td><span class=\"badge ${s.isStreaming ? \"streaming\" : \"idle\"}\">${s.isStreaming ? \"streaming\" : \"idle\"}</span></td>\n                  <td>\n                    <div class=\"actions\">\n                      <button class=\"primary\" @click=${(e) => { e.stopPropagation(); this._resumeSession(s.sessionKey); }}>Resume</button>\n                      <button class=\"danger\" @click=${(e) => this._closeSession(s.sessionKey, e)}>Close</button>\n                    </div>\n                  </td>\n                </tr>\n              `)}\n            </tbody>\n          </table>\n        `}\n    `;\n  }\n}\ncustomElements.define(\"gw-sessions\", GwSessions);\n\n// ============================================================================\n// gw-plugins â€” Plugins Admin Panel\n// ============================================================================\n\nclass GwPlugins extends LitElement {\n  static properties = {\n    data: { type: Object },\n    loading: { type: Boolean },\n  };\n\n  static styles = css`\n    :host {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      overflow-y: auto;\n      padding: 20px;\n    }\n\n    .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 16px;\n    }\n\n    h2 { font-size: 18px; font-weight: 600; }\n    h3 { font-size: 14px; font-weight: 600; margin: 16px 0 8px; color: var(--text-secondary); }\n\n    button {\n      background: var(--bg-tertiary);\n      border: 1px solid var(--border);\n      color: var(--text-secondary);\n      padding: 6px 12px;\n      border-radius: var(--radius-sm);\n      cursor: pointer;\n      font-size: 12px;\n    }\n    button:hover { background: var(--bg-hover); color: var(--text-primary); }\n\n    .card {\n      background: var(--bg-secondary);\n      border: 1px solid var(--border-subtle);\n      border-radius: var(--radius);\n      padding: 12px 16px;\n      margin-bottom: 8px;\n      display: flex;\n      align-items: center;\n      gap: 12px;\n    }\n\n    .card-icon {\n      width: 36px; height: 36px;\n      border-radius: var(--radius-sm);\n      background: var(--bg-tertiary);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 18px;\n      flex-shrink: 0;\n    }\n\n    .card-info { flex: 1; }\n    .card-name { font-weight: 500; font-size: 14px; }\n    .card-desc { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }\n\n    .tag {\n      font-size: 11px;\n      padding: 2px 8px;\n      border-radius: 10px;\n      background: var(--accent-muted);\n      color: var(--accent);\n    }\n\n    .empty { color: var(--text-muted); text-align: center; padding: 40px; }\n  `;\n\n  constructor() {\n    super();\n    this.data = null;\n    this.loading = true;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._load();\n  }\n\n  async _load() {\n    this.loading = true;\n    try {\n      this.data = await gw.request(\"plugins.list\");\n    } catch {\n      this.data = null;\n    }\n    this.loading = false;\n  }\n\n  render() {\n    const icons = { telegram: \"âœˆï¸\", discord: \"ðŸŽ®\", webchat: \"ðŸ’¬\" };\n\n    if (!this.data) {\n      return html`<div class=\"empty\">${this.loading ? \"Loading...\" : \"Failed to load plugins\"}</div>`;\n    }\n\n    return html`\n      <div class=\"header\">\n        <h2>Loaded Plugins</h2>\n        <button @click=${() => this._load()}>Refresh</button>\n      </div>\n\n      <h3>Channels (${this.data.channels?.length ?? 0})</h3>\n      ${(this.data.channels ?? []).map((ch) => html`\n        <div class=\"card\">\n          <div class=\"card-icon\">${icons[ch] ?? \"ðŸ“¡\"}</div>\n          <div class=\"card-info\">\n            <div class=\"card-name\">${ch}</div>\n            <div class=\"card-desc\">Channel plugin</div>\n          </div>\n          <span class=\"tag\">active</span>\n        </div>\n      `)}\n\n      <h3>Tools (${this.data.tools?.length ?? 0})</h3>\n      ${(this.data.tools ?? []).length === 0\n        ? html`<div class=\"empty\">No custom tools registered</div>`\n        : (this.data.tools ?? []).map((t) => html`\n            <div class=\"card\">\n              <div class=\"card-icon\">ðŸ”§</div>\n              <div class=\"card-info\"><div class=\"card-name\">${t}</div></div>\n              <span class=\"tag\">active</span>\n            </div>\n          `)}\n    `;\n  }\n}\ncustomElements.define(\"gw-plugins\", GwPlugins);\n\n// ============================================================================\n// gw-health â€” Health Panel\n// ============================================================================\n\nclass GwHealth extends LitElement {\n  static properties = {\n    data: { type: Object },\n    loading: { type: Boolean },\n  };\n\n  static styles = css`\n    :host {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      overflow-y: auto;\n      padding: 20px;\n    }\n\n    .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 16px;\n    }\n\n    h2 { font-size: 18px; font-weight: 600; }\n\n    button {\n      background: var(--bg-tertiary);\n      border: 1px solid var(--border);\n      color: var(--text-secondary);\n      padding: 6px 12px;\n      border-radius: var(--radius-sm);\n      cursor: pointer;\n      font-size: 12px;\n    }\n    button:hover { background: var(--bg-hover); color: var(--text-primary); }\n\n    .grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n      gap: 12px;\n      margin-bottom: 24px;\n    }\n\n    .stat-card {\n      background: var(--bg-secondary);\n      border: 1px solid var(--border-subtle);\n      border-radius: var(--radius);\n      padding: 16px;\n    }\n\n    .stat-label {\n      font-size: 11px;\n      text-transform: uppercase;\n      letter-spacing: .5px;\n      color: var(--text-secondary);\n      margin-bottom: 6px;\n    }\n\n    .stat-value {\n      font-size: 28px;\n      font-weight: 700;\n      color: var(--text-primary);\n    }\n\n    .stat-sub {\n      font-size: 12px;\n      color: var(--text-muted);\n      margin-top: 4px;\n    }\n\n    pre {\n      background: var(--bg-secondary);\n      border: 1px solid var(--border-subtle);\n      border-radius: var(--radius);\n      padding: 16px;\n      font-family: var(--font-mono);\n      font-size: 12px;\n      overflow-x: auto;\n      color: var(--text-secondary);\n      line-height: 1.5;\n    }\n\n    .empty { color: var(--text-muted); text-align: center; padding: 40px; }\n  `;\n\n  constructor() {\n    super();\n    this.data = null;\n    this.loading = true;\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this._load();\n  }\n\n  async _load() {\n    this.loading = true;\n    try {\n      this.data = await gw.request(\"health\");\n    } catch {\n      this.data = null;\n    }\n    this.loading = false;\n  }\n\n  render() {\n    if (!this.data) {\n      return html`<div class=\"empty\">${this.loading ? \"Loading...\" : \"Failed to load health data\"}</div>`;\n    }\n\n    const pool = this.data.pool ?? {};\n    const queue = this.data.queue ?? {};\n\n    return html`\n      <div class=\"header\">\n        <h2>System Health</h2>\n        <button @click=${() => this._load()}>Refresh</button>\n      </div>\n\n      <div class=\"grid\">\n        <div class=\"stat-card\">\n          <div class=\"stat-label\">RPC Processes</div>\n          <div class=\"stat-value\">${pool.total ?? 0}</div>\n          <div class=\"stat-sub\">${pool.active ?? 0} active / ${pool.idle ?? 0} idle (max ${pool.maxCapacity ?? 0})</div>\n        </div>\n        <div class=\"stat-card\">\n          <div class=\"stat-label\">Active Sessions</div>\n          <div class=\"stat-value\">${this.data.sessions ?? 0}</div>\n        </div>\n        <div class=\"stat-card\">\n          <div class=\"stat-label\">Message Queue</div>\n          <div class=\"stat-value\">${queue.totalPending ?? 0}</div>\n          <div class=\"stat-sub\">${queue.sessions ?? 0} session queue(s)</div>\n        </div>\n      </div>\n\n      <h3 style=\"font-size:14px; color:var(--text-secondary); margin-bottom:8px;\">Raw Health Data</h3>\n      <pre>${JSON.stringify(this.data, null, 2)}</pre>\n    `;\n  }\n}\ncustomElements.define(\"gw-health\", GwHealth);\n",
};
