# 任务007: 实现 FileChangesViewer 组件

**状态**: Done
**优先级**: High
**预计时间**: 1.5h

**占用者**: Agent A
**锁定时间**: 2026-01-27 12:35:00

## 任务描述

实现 FileChangesViewer 组件，在 TUI 中显示文件变化列表。

## 依赖任务

    - [x] 任务001 (状态: Done) - 创建插件目录结构和类型定义

**说明**: 只有所有标记的依赖任务状态为 Done 后，此任务才能开始执行。

## 验收标准

- [x] 使用 pi-tui 的 Container、SelectList 组件
- [x] 显示文件路径和统计信息（additions/deletions）
- [x] 支持键盘导航（上下箭头、Enter 选择、Esc 取消）
- [x] 支持滚动（如果文件很多）
- [x] 显示文件数量和滚动信息
- [x] 支持过滤（可选）
- [x] 适配主题颜色（绿色表示 additions，红色表示 deletions）
- [x] 代码通过 TypeScript 类型检查

## 完成记录

- 开始时间: 2026-01-27 12:35:00
- 完成时间: 2026-01-27 12:40:00
- 耗时: 约 5 分钟

## 交付物

- [x] `~/.pi/agent/extensions/checkpoint-v2/components/file-changes-viewer.ts`（完整实现）
- [x] TypeScript 类型检查通过

## 实现的功能

### 核心方法

- `render(width)` - 渲染组件
- `handleInput(data)` - 处理键盘输入（委托给 SelectList）
- `invalidate()` - 清除缓存
- `getSelectedFile()` - 获取选中的文件
- `setSelectedIndex(index)` - 设置选中索引

### 辅助方法

- `createSelectItems()` - 创建 SelectList items
- `formatStats(file)` - 格式化文件统计（colored）
- `getFileCount()` - 获取文件数量
- `getSummary()` - 获取变化摘要
- `filterByAction(action)` - 按动作类型过滤
- `sortByPath()` - 按路径排序
- `sortByModifications()` - 按修改量排序

### 特性

✅ 使用 pi-tui 的 SelectList 组件
✅ 显示文件路径和统计信息
✅ 支持键盘导航
✅ 适配主题颜色（success/error）
✅ 支持多种排序方式
✅ TypeScript 类型检查通过

## 备注

- 如果 pi-tui 没有类型定义，使用 `any` 类型
- 使用 `theme.fg()` 方法应用颜色
- 组件通过 `ctx.ui.custom()` 显示