# 任务006: 实现 /redo 命令

**状态**: Done
**优先级**: High
**预计时间**: 1h

**占用者**: Agent A
**锁定时间**: 2026-01-27 12:20:00

## 任务描述

实现 /redo 命令，允许用户重做被撤销的文件修改。

## 依赖任务

    - [x] 任务003 (状态: Done) - 实现 CheckpointManager 模块
    - [x] 任务004 (状态: Done) - 实现 Git 存储层

**说明**: 只有所有标记的依赖任务状态为 Done 后，此任务才能开始执行。

## 验收标准

- [x] 实现 /redo 命令处理函数
- [x] 等待 agent 完成（`ctx.waitForIdle()`）
- [x] 检查是否可以 redo（`checkpointManager.canRedo()`）
- [x] 获取要重做的 checkpoint
- [x] 调用 `gitStorage.restore()` 恢复文件
- [x] 更新 CheckpointManager 状态
- [x] 持久化状态到 session
- [x] 显示成功通知（文件数量）
- [x] 处理错误情况（无 checkpoint、Git 失败等）
- [x] 代码通过 TypeScript 类型检查

## 完成记录

- 开始时间: 2026-01-27 12:20:00
- 完成时间: 2026-01-27 12:20:00
- 耗时: 随任务005一起完成

## 交付物

- [x] `~/.pi/agent/extensions/checkpoint-v2/commands.ts`（包含 /redo 命令实现）
- [x] 与任务005一起完成

## 实现的功能

- ✅ 等待 agent 完成
- ✅ 检查是否可以 redo
- ✅ 调用 CheckpointManager.redo()
- ✅ 调用 GitStorage.restore() 恢复文件
- ✅ 持久化状态到 session
- ✅ 显示恢复的文件数量
- ✅ 错误处理和通知