# 任务010: 设置临时测试环境

**状态**: Todo
**优先级**: P2
**预计时间**: 10 分钟

## 任务描述

创建临时测试目录和测试文件，用于集成测试 checkpoint-v2 的功能。

## 验收标准

- [ ] 创建临时测试目录 `/tmp/checkpoint-v2-test`
- [ ] 初始化 Git 仓库
- [ ] 创建测试文件
- [ ] 配置测试环境

## 实施步骤

1. **创建测试目录**
   ```bash
   mkdir -p /tmp/checkpoint-v2-test
   cd /tmp/checkpoint-v2-test
   ```

2. **初始化 Git 仓库**
   ```bash
   git init
   git config user.name "Test User"
   git config user.email "test@example.com"
   echo "# Test Project" > README.md
   git add README.md
   git commit -m "Initial commit"
   ```

3. **创建测试文件**
   ```bash
   # 创建测试文件
   cat > test1.ts << 'EOF'
export function add(a: number, b: number): number {
  return a + b;
}
EOF

   cat > test2.ts << 'EOF'
export function multiply(a: number, b: number): number {
  return a * b;
}
EOF

   # 提交初始版本
   git add test1.ts test2.ts
   git commit -m "Add test files"
   ```

4. **创建测试脚本**
   ```bash
   cat > /tmp/checkpoint-v2-test/test-scenario.sh << 'EOF'
   #!/bin/bash
   # 测试场景脚本

   echo "=== Checkpoint V2 Test Scenario ==="

   # 场景 1: 修改文件
   echo "Scenario 1: Modify file"
   cat > test1.ts << 'EOF'
export function add(a: number, b: number): number {
  return a + b + 1;  // Bug!
}
EOF

   # 场景 2: 创建新文件
   echo "Scenario 2: Create new file"
   cat > test3.ts << 'EOF'
export function subtract(a: number, b: number): number {
  return a - b;
}
EOF

   # 场景 3: 删除文件
   echo "Scenario 3: Delete file"
   rm test2.ts

   echo "Test scenarios prepared. Ready for checkpoint testing."
   EOF

   chmod +x /tmp/checkpoint-v2-test/test-scenario.sh
   ```

5. **创建测试用例文档**
   ```bash
   cat > /tmp/checkpoint-v2-test/TEST_CASES.md << 'EOF'
   # Checkpoint V2 测试用例

   ## 测试环境
   - 目录: /tmp/checkpoint-v2-test
   - Git 仓库: 已初始化
   - 初始文件: README.md, test1.ts, test2.ts

   ## 测试用例

   ### 用例 1: 基本修改和 undo
   1. 修改 test1.ts（添加注释）
   2. 执行 `/changes` 查看
   3. 执行 `/undo` 恢复
   4. 验证文件已恢复

   ### 用例 2: 多次 undo/redo
   1. 修改 test1.ts
   2. 修改 test2.ts
   3. 创建 test3.ts
   4. 执行 `/undo` 3 次
   5. 执行 `/redo` 3 次
   6. 验证所有操作正确

   ### 用例 3: 文件创建和删除
   1. 创建 test3.ts
   2. 删除 test2.ts
   3. 执行 `/undo` 恢复 test2.ts
   4. 执行 `/undo` 删除 test3.ts

   ### 用例 4: 查看 diff
   1. 修改 test1.ts
   2. 执行 `/changes`
   3. 选择 test1.ts 查看 diff
   4. 验证 diff 显示正确

   ### 用例 5: RevertInfo 显示
   1. 修改多个文件
   2. 执行 `/undo`
   3. 验证 RevertInfo 显示正确的文件列表
   4. 验证 redo 提示显示
   EOF
   ```

6. **验证环境**
   ```bash
   cd /tmp/checkpoint-v2-test
   git status
   ls -la
   cat test1.ts
   ```

## 依赖任务

无

## 阻塞原因

无

## 备注

- 测试环境应该独立，不影响实际项目
- 每次测试前可以重置环境：`cd /tmp && rm -rf checkpoint-v2-test` 然后重新创建
- 测试文件应该简单，便于观察变化
- 建议保存测试脚本，方便重复测试