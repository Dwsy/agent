```mermaid
flowchart LR
    %% Style definitions
    classDef event fill:#ff9800,stroke:#e65100,color:#000
    classDef command fill:#2196f3,stroke:#0d47a1,color:#fff
    classDef actor fill:#ffeb3b,stroke:#f57f17,color:#000
    classDef system fill:#9c27b0,stroke:#4a148c,color:#fff
    classDef aggregate fill:#4caf50,stroke:#1b5e20,color:#fff

    %% Actors
    Dev[Developer]:::actor

    %% Commands
    CmdLaunch[Launch App]:::command

    %% Events
    EvtAppStarted[App Started]:::event
    EvtScanStarted[Directory Scan Started]:::event
    EvtFileFound[Session File Found]:::event
    EvtFileParsed[File Parsed]:::event
    EvtMetadataExtracted[Metadata Extracted]:::event
    EvtContentIndexed[Content Indexed]:::event
    EvtSessionsLoaded[Sessions Loaded]:::event

    %% Aggregates
    AggIndex[Session Index<br/>Map<id, SessionInfo>]:::aggregate
    AggSearch[Search Index<br/>Fuzzy search structure]:::aggregate

    %% External Systems
    PiDir[Pi Sessions Directory<br/>~/.pi/agent/sessions/]:::system

    %% Flow
    Dev --> CmdLaunch
    CmdLaunch --> EvtAppStarted

    EvtAppStarted -->|Read directory| EvtScanStarted
    EvtScanStarted --> PiDir
    PiDir -->|Return .jsonl files| EvtFileFound

    EvtFileFound -->|Parse JSONL line by line| EvtFileParsed
    EvtFileParsed -->|Extract SessionInfoEntry| EvtMetadataExtracted
    EvtMetadataExtracted -->|Collect message texts| EvtContentIndexed

    EvtMetadataExtracted -->|Store in index| AggIndex
    EvtContentIndexed -->|Build search index| AggSearch

    %% Loop for multiple files
    EvtContentIndexed -->|Next file| EvtFileFound

    %% Completion
    EvtContentIndexed -->|All files processed| EvtSessionsLoaded

    %% Aggregate State Changes
    AggIndex -.->|State: Empty → Populated| EvtSessionsLoaded
    AggSearch -.->|State: Empty → Ready| EvtSessionsLoaded
```

## Process: Load Sessions

### Purpose
Scan Pi sessions directory, parse all JSONL files, extract metadata, and build in-memory search index.

### Events & State Changes

| Event | AggIndex Changes | AggSearch Changes |
|-------|------------------|-------------------|
| Sessions Loaded | Empty → Populated<br/>(Map<id, SessionInfo>) | Empty → Ready<br/>(Fuzzy search structure) |

### Key Data Extracted per Session
- **id**: Session identifier
- **path**: File path
- **cwd**: Working directory
- **created**: Creation timestamp
- **modified**: Last modified timestamp
- **messageCount**: Total messages
- **firstMessage**: Preview text
- **allMessagesText**: Concatenated message content for search

### Performance Considerations
- Parse JSONL files line by line (streaming)
- Build search index incrementally
- Show progress indicator for large collections