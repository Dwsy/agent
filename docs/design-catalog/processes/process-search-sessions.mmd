```mermaid
flowchart TB
    %% Style definitions
    classDef event fill:#ff9800,stroke:#e65100,color:#000
    classDef command fill:#2196f3,stroke:#0d47a1,color:#fff
    classDef actor fill:#ffeb3b,stroke:#f57f17,color:#000
    classDef aggregate fill:#4caf50,stroke:#1b5e20,color:#fff
    classDef hotspot fill:#f44336,stroke:#b71c1c,color:#fff

    %% Actors
    Dev[Developer]:::actor

    %% Commands
    CmdInput[Type Search Query]:::command
    CmdToggle[Toggle Tool Calls]:::command

    %% Events
    EvtQueryChanged[Query Changed]:::event
    EvtSearchExecuted[Search Executed]:::event
    EvtResultsComputed[Results Computed]:::event
    EvtFilterToggled[Filter Toggled]:::event
    EvtResultsUpdated[Results Updated]:::event

    %% Aggregates
    AggSearch[Search State<br/>{query, includeToolCalls}]:::aggregate
    AggIndex[Session Index<br/>{sessions, searchIndex}]:::aggregate
    AggResults[Search Results<br/>{matchedSessions}]:::aggregate

    %% Hotspots
    Hot1[? Fuzzy search algorithm?]:::hotspot
    Hot2[? Debounce strategy?]:::hotspot

    %% Search Flow
    Dev --> CmdInput
    CmdInput --> EvtQueryChanged
    EvtQueryChanged -->|Update query| AggSearch

    AggSearch -->|Query ready| EvtSearchExecuted
    EvtSearchExecuted -->|Search in index| AggIndex
    AggIndex -->|Match sessions| EvtResultsComputed
    EvtResultsComputed -->|Update results| AggResults
    AggResults --> EvtResultsUpdated

    %% Filter Flow
    Dev --> CmdToggle
    CmdToggle --> EvtFilterToggled
    EvtFilterToggled -->|Toggle flag| AggSearch
    AggSearch -->|Re-execute search| EvtSearchExecuted

    %% Hotspot connections
    EvtSearchExecuted -.question.- Hot1
    EvtQueryChanged -.question.- Hot2

    %% State annotations
    AggSearch -.->|Initial state| query: ""
    AggSearch -.->|After typing| query: "react component"
    AggSearch -.->|Default| includeToolCalls: false

    AggResults -.->|Before search| matchedSessions: []
    AggResults -.->|After search| matchedSessions: [Session1, Session3, Session5]
```

## Process: Search Sessions

### Description
User types a search query to find sessions containing specific content in messages.

### Aggregates

| Aggregate | State | Events |
|-----------|-------|--------|
| **Search State** | query, includeToolCalls | Query Changed, Filter Toggled |
| **Session Index** | sessions, searchIndex | (Read-only during search) |
| **Search Results** | matchedSessions | Results Updated |

### Event Details

| Event | Trigger | Data Changes |
|-------|---------|--------------|
| Query Changed | User types in search box | SearchState.query |
| Search Executed | Query ready (debounced) | Reads SessionIndex |
| Results Computed | Search algorithm completes | SearchResults.matchedSessions |
| Results Updated | Results ready | UI displays results |
| Filter Toggled | User clicks checkbox | SearchState.includeToolCalls |

### State Transitions

```
Search State:
  query: "" → "react" → "react component" → ""
  includeToolCalls: false → true → false

Search Results:
  matchedSessions: [] → [S1, S3, S5] → [S2, S4] → []
```

### Hotspots

1. **Fuzzy search algorithm** - Which library to use? (fuse.js, flexsearch, custom?)
2. **Debounce strategy** - How long to wait before executing search? (200ms? 300ms?)