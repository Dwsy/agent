```mermaid
stateDiagram-v2
    direction TB

    [*] --> Idle

    Idle --> Typing: User types query
    Typing --> Idle: Query cleared
    Typing --> Searching: Debounce timeout
    Searching --> ResultsReady: Search completed
    Searching --> Error: Search failed
    ResultsReady --> Searching: Query changed
    ResultsReady --> Idle: Results cleared
    Error --> Idle: User retries

    ResultsReady --> ResultsReady: Filter toggled (re-search)
    Error --> Searching: User retries

    note right of Idle
        query: ""
        includeToolCalls: false
        results: []
    end note

    note right of Typing
        query: "reac..."
        includeToolCalls: false
        results: previous
    end note

    note right of Searching
        query: "react component"
        includeToolCalls: false
        results: []
    end note

    note right of ResultsReady
        query: "react component"
        includeToolCalls: false
        results: [S1, S3, S5]
    end note

    note right of Error
        query: "react component"
        includeToolCalls: false
        error: "Index not ready"
    end note
```

## State Chart: Search State

### States

| State | Description | Data |
|-------|-------------|------|
| **Idle** | No active search | query: "", results: [] |
| **Typing** | User is typing | query: "reac...", results: previous |
| **Searching** | Query being executed | query: "react component", results: [] |
| **ResultsReady** | Search completed | query: "react component", results: [S1, S3, S5] |
| **Error** | Search failed | query: "react component", error: message |

### Transitions

| From | To | Trigger | Action |
|------|-----|---------|--------|
| Idle | Typing | User types query | Update query |
| Typing | Idle | Query cleared | Reset query |
| Typing | Searching | Debounce timeout | Execute search |
| Searching | ResultsReady | Search completed | Update results |
| Searching | Error | Search failed | Store error |
| ResultsReady | Searching | Query changed | Re-execute search |
| ResultsReady | Idle | Results cleared | Reset state |
| Error | Idle | User retries | Clear error |
| ResultsReady | ResultsReady | Filter toggled | Re-search with new filter |
| Error | Searching | User retries | Re-execute search |

### Data Changes per Transition

```
Idle → Typing:
  query: "" → "reac"
  results: [] → []

Typing → Searching:
  query: "reac" → "react component"
  results: [] → []

Searching → ResultsReady:
  query: "react component" (unchanged)
  results: [] → [S1, S3, S5]

ResultsReady → ResultsReady (filter toggled):
  query: "react component" (unchanged)
  includeToolCalls: false → true
  results: [S1, S3, S5] → [S1, S2, S3, S5]
```