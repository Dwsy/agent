# å®ç° tmux æŠ€èƒ½

> æ·»åŠ å®Œæ•´çš„ tmux ç»ˆç«¯ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒå­ä»»åŠ¡æ‰§è¡Œã€åå°é•¿ä»»åŠ¡ç®¡ç†ã€æœåŠ¡å¯åŠ¨ä¸ç›‘æ§

## èƒŒæ™¯ä¸ç›®çš„ (Why)

å½“å‰ Agent ç¼ºå°‘äº¤äº’å¼ç»ˆç«¯ç®¡ç†èƒ½åŠ›ï¼Œæ— æ³•æ‰§è¡Œéœ€è¦äº¤äº’æˆ–ç›‘æ§çš„ä»»åŠ¡ã€è¿è¡Œåå°é•¿ä»»åŠ¡æˆ–å¯åŠ¨æœåŠ¡ã€‚å‚è€ƒ mitsuhiko/agent-stuff çš„ tmux æŠ€èƒ½ï¼Œå®ç°æ·±åº¦èå…¥ Pi Agent ä½“ç³»çš„ tmux ç®¡ç†èƒ½åŠ›ã€‚

## å˜æ›´å†…å®¹æ¦‚è¿° (What)

- âœ¨ æ–°å¢ `~/.pi/agent/skills/tmux/` æŠ€èƒ½ç›®å½•
- âœ¨ å®ç° Bun + TypeScript æ ¸å¿ƒåº“ (`lib.ts`)
- âœ¨ å®ç°ä¼šè¯æŒä¹…åŒ–å­˜å‚¨ (JSON)
- âœ¨ å®ç°è‡ªåŠ¨æ¸…ç†æœºåˆ¶
- âœ¨ å®ç° CLI å‘½ä»¤æ¥å£
- âœ¨ æ·»åŠ è¾…åŠ©è„šæœ¬å’Œç¤ºä¾‹

## å…³è” Issue ä¸ ToDo æ¡ç›® (Links)
- **Issues:** `docs/issues/tmux/20260107-tmux æŠ€èƒ½å®ç°.md`

## æµ‹è¯•ä¸éªŒè¯ç»“æœ (Test Result)
- [x] å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆæ‰‹åŠ¨éªŒè¯æ‰€æœ‰å‘½ä»¤ï¼‰
- [x] é›†æˆæµ‹è¯•éªŒè¯ï¼ˆåˆ›å»ºã€åˆ—è¡¨ã€æ•è·ã€åˆ é™¤æµç¨‹ï¼‰
- [x] æ‰‹åŠ¨å›å½’æµ‹è¯•é€šè¿‡

**æµ‹è¯•è¾“å‡ºï¼š**
```bash
$ bun lib.ts create test "echo 'Hello from tmux!' && echo 'Done'" task
âœ… Created session: pi-task-test-20260107045550

$ bun lib.ts list
ID                           NAME      CATEGORY  STATUS    LAST ACTIVITY
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pi-task-test-20260107045550  test      task      running   0m ago

$ bun lib.ts capture pi-task-test-20260107045550
Hello from tmux!
Done

$ bun lib.ts kill pi-task-test-20260107045550
âœ… Killed session: pi-task-test-20260107045550
```

## é£é™©ä¸å½±å“è¯„ä¼° (Risk Assessment)
- **é£é™©ç‚¹**ï¼štmux socket è·¯å¾„å†²çª
- **ç¼“è§£æªæ–½**ï¼šä½¿ç”¨ç‹¬ç«‹ç§ç”¨ socket è·¯å¾„ (`/tmp/pi-tmux-sockets`)
- **å½±å“èŒƒå›´**ï¼šæ–°å¢æŠ€èƒ½ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½

## å›æ»šæ–¹æ¡ˆ (Rollback Plan)
åˆ é™¤ `~/.pi/agent/skills/tmux/` ç›®å½•å³å¯å®Œå…¨ç§»é™¤ï¼š

```bash
rm -rf ~/.pi/agent/skills/tmux/
```

---

## å…ƒæ•°æ®

| å­—æ®µ | å†…å®¹ |
|------|------|
| **æ–‡ä»¶å** | 20260107-å®ç° tmux æŠ€èƒ½.md |
| **åˆ›å»ºæ—¶é—´** | 2026-01-07 |
| **çŠ¶æ€** | ğŸ“ å¾…å®¡æŸ¥ |
| **ç±»å‹** | âœ¨ Feature |
| **å®¡æŸ¥äºº** | - |

## å˜æ›´ç±»å‹

- [ ] ğŸ› Bug Fix
- [x] âœ¨ New Feature
- [ ] ğŸ“ Documentation
- [ ] ğŸš€ Refactoring
- [ ] âš¡ Performance
- [ ] ğŸ”’ Security
- [ ] ğŸ§ª Testing

## æ–‡ä»¶å˜æ›´åˆ—è¡¨

| æ–‡ä»¶ | å˜æ›´ç±»å‹ | æè¿° |
|------|---------|------|
| `~/.pi/agent/skills/tmux/SKILL.md` | æ–°å¢ | æŠ€èƒ½æ ¸å¿ƒæ–‡æ¡£ |
| `~/.pi/agent/skills/tmux/lib.ts` | æ–°å¢ | TypeScript æ ¸å¿ƒåº“ + CLI |
| `~/.pi/agent/skills/tmux/types/index.ts` | æ–°å¢ | TypeScript ç±»å‹å®šä¹‰ |
| `~/.pi/agent/skills/tmux/package.json` | æ–°å¢ | é¡¹ç›®é…ç½® |
| `~/.pi/agent/skills/tmux/tsconfig.json` | æ–°å¢ | TypeScript é…ç½® |
| `~/.pi/agent/skills/tmux/scripts/wait-for-text.sh` | æ–°å¢ | ç­‰å¾…æ–‡æœ¬è„šæœ¬ |
| `~/.pi/agent/skills/tmux/scripts/find-sessions.sh` | æ–°å¢ | æŸ¥æ‰¾ä¼šè¯è„šæœ¬ |
| `~/.pi/agent/skills/tmux/examples/python-repl.ts` | æ–°å¢ | Python REPL ç¤ºä¾‹ |
| `~/.pi/agent/skills/tmux/examples/long-task.ts` | æ–°å¢ | é•¿ä»»åŠ¡ç¤ºä¾‹ |
| `~/.pi/agent/skills/tmux/examples/start-service.ts` | æ–°å¢ | æœåŠ¡å¯åŠ¨ç¤ºä¾‹ |

## è¯¦ç»†å˜æ›´è¯´æ˜

### 1. æ ¸å¿ƒåº“å®ç°

**é—®é¢˜ï¼š** éœ€è¦ TypeScript å®ç°çš„ tmux ç®¡ç†èƒ½åŠ›

**æ–¹æ¡ˆï¼š**
- å®ç° `TmuxManager` ç±»ï¼Œå°è£…æ‰€æœ‰ tmux æ“ä½œ
- ä½¿ç”¨ Bun çš„ `$` æ¨¡æ¿å­—ç¬¦ä¸²æ‰§è¡Œ shell å‘½ä»¤
- å®ç°ä¼šè¯æŒä¹…åŒ–ï¼ˆJSON æ–‡ä»¶å­˜å‚¨ï¼‰
- å®ç°è‡ªåŠ¨æ¸…ç†æœºåˆ¶ï¼ˆé»˜è®¤ 24 å°æ—¶ï¼‰

**å½±å“èŒƒå›´ï¼š** æ–°å¢æŠ€èƒ½ï¼Œæ— å½±å“

### 2. CLI å‘½ä»¤æ¥å£

**é—®é¢˜ï¼š** æä¾›æ˜“ç”¨çš„å‘½ä»¤è¡Œæ¥å£

**æ–¹æ¡ˆï¼š**
- å®ç° 9 ä¸ªæ ¸å¿ƒå‘½ä»¤ï¼šcreate, list, status, send, capture, kill, cleanup, attach, sync
- ç»Ÿä¸€è¾“å‡ºæ ¼å¼å’Œé”™è¯¯å¤„ç†
- è‡ªåŠ¨æ‰“å°ç›‘æ§å‘½ä»¤

**å½±å“èŒƒå›´ï¼š** CLI ç”¨æˆ·

### 3. ä¼šè¯ç®¡ç†

**é—®é¢˜ï¼š** éœ€è¦å¯é çš„ä¼šè¯ç®¡ç†å’ŒçŠ¶æ€è·Ÿè¸ª

**æ–¹æ¡ˆï¼š**
- ä¼šè¯å‘½åï¼š`pi-{category}-{name}-{timestamp}`
- çŠ¶æ€æ£€æµ‹ï¼šrunning, idle, exited
- æŒä¹…åŒ–å­˜å‚¨ï¼š`/tmp/pi-tmux-sessions.json`
- è‡ªåŠ¨åŒæ­¥ï¼šä¸ tmux å®é™…çŠ¶æ€åŒæ­¥

**å½±å“èŒƒå›´ï¼š** ä¼šè¯ç®¡ç†åŠŸèƒ½

### 4. è¾…åŠ©è„šæœ¬

**é—®é¢˜ï¼š** æä¾› bash å…¼å®¹çš„è¾…åŠ©å·¥å…·

**æ–¹æ¡ˆï¼š**
- ä» mitsuhiko/agent-stuff å¤åˆ¶ `wait-for-text.sh`
- ä» mitsuhiko/agent-stuff å¤åˆ¶ `find-sessions.sh`
- ä¿æŒä¸åŸè„šæœ¬å…¼å®¹

**å½±å“èŒƒå›´ï¼š** bash ç”¨æˆ·

## æµ‹è¯•å‘½ä»¤

```bash
# æµ‹è¯•åˆ›å»ºä¼šè¯
bun ~/.pi/agent/skills/tmux/lib.ts create test "echo 'Hello'" task

# æµ‹è¯•åˆ—è¡¨
bun ~/.pi/agent/skills/tmux/lib.ts list

# æµ‹è¯•æ•è·è¾“å‡º
bun ~/.pi/agent/skills/tmux/lib.ts capture pi-task-test-*

# æµ‹è¯•åˆ é™¤ä¼šè¯
bun ~/.pi/agent/skills/tmux/lib.ts kill pi-task-test-*

# æµ‹è¯•è‡ªåŠ¨æ¸…ç†
bun ~/.pi/agent/skills/tmux/lib.ts cleanup

# è¿è¡Œç¤ºä¾‹
bun ~/.pi/agent/skills/tmux/examples/long-task.ts
```

## ç ´åæ€§å˜æ›´

**æ˜¯å¦æœ‰ç ´åæ€§å˜æ›´ï¼Ÿ**

- [x] å¦

## æ€§èƒ½å½±å“

**æ˜¯å¦æœ‰æ€§èƒ½å½±å“ï¼Ÿ**

- [x] æ— å½±å“

## ä¾èµ–å˜æ›´

**æ˜¯å¦å¼•å…¥æ–°çš„ä¾èµ–ï¼Ÿ**

- [x] å¦ï¼ˆä»…ä½¿ç”¨ Bun å†…ç½®åŠŸèƒ½ï¼‰

## å®‰å…¨è€ƒè™‘

**æ˜¯å¦æœ‰å®‰å…¨å½±å“ï¼Ÿ**

- [x] å¦ï¼ˆä½¿ç”¨ç‹¬ç«‹ socketï¼Œå­—é¢æ¨¡å¼å‘é€æŒ‰é”®ï¼‰

## æ–‡æ¡£å˜æ›´

**æ˜¯å¦éœ€è¦æ›´æ–°æ–‡æ¡£ï¼Ÿ**

- [x] æ˜¯ - å·²åˆ›å»º `SKILL.md`

## ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

### åŠŸèƒ½æ€§
- [x] ä»£ç å®ç°äº†éœ€æ±‚
- [x] è¾¹ç•Œæƒ…å†µå·²å¤„ç†ï¼ˆsocket ç›®å½•ã€ä¼šè¯ä¸å­˜åœ¨ç­‰ï¼‰
- [x] é”™è¯¯å¤„ç†å®Œå–„ï¼ˆtry-catchï¼ŒçŠ¶æ€æ£€æµ‹ï¼‰

### ä»£ç è´¨é‡
- [x] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒï¼ˆTypeScriptï¼Œæ¨¡å—åŒ–ï¼‰
- [x] å˜é‡å‘½åæ¸…æ™°ï¼ˆsession, socket, targetï¼‰
- [x] æ²¡æœ‰å†—ä½™ä»£ç ï¼ˆç²¾ç®€é«˜æ•ˆï¼‰

### æµ‹è¯•
- [x] æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•ï¼ˆæ‰‹åŠ¨æµ‹è¯•ï¼‰
- [x] æµ‹è¯•è¦†ç›–å…³é”®è·¯å¾„ï¼ˆåˆ›å»ºã€åˆ—è¡¨ã€æ•è·ã€åˆ é™¤ï¼‰
- [x] æµ‹è¯•é€šè¿‡

## å®¡æŸ¥æ—¥å¿—

- **[2026-01-07 13:00] [Pi Agent]**: åˆå§‹æäº¤
  - å·²å®ç°æ‰€æœ‰åŠŸèƒ½
  - æµ‹è¯•é€šè¿‡

## æœ€ç»ˆçŠ¶æ€

- **åˆå¹¶æ—¶é—´:** [å¾…å®š]
- **åˆå¹¶äºº:** [å¾…å®š]
- **Commit Hash:** [å¾…å®š]
- **éƒ¨ç½²çŠ¶æ€:** å¾…éƒ¨ç½²