# Issue: tmux æŠ€èƒ½å®ç°

## å…ƒæ•°æ®

| å­—æ®µ | å†…å®¹ |
|------|------|
| **æ–‡ä»¶å** | 20260107-tmux æŠ€èƒ½å®ç°.md |
| **åˆ›å»ºæ—¶é—´** | 2025-01-07 |
| **çŠ¶æ€** | ğŸš§ è¿›è¡Œä¸­ |
| **ä¼˜å…ˆçº§** | ğŸŸ  P1 |
| **è´Ÿè´£äºº** | Pi Agent |
| **é¢„è®¡å·¥æ—¶** | 2-3h |

## Goal

å®ç°å®Œæ•´çš„ tmux æŠ€èƒ½ï¼Œæ”¯æŒå­ä»»åŠ¡æ‰§è¡Œã€åå°é•¿ä»»åŠ¡ç®¡ç†ã€æœåŠ¡å¯åŠ¨ä¸ç›‘æ§ï¼Œä½¿ç”¨ Bun + TypeScript å®ç°ï¼Œå…·å¤‡ä¼šè¯æŒä¹…åŒ–ã€è‡ªåŠ¨æ¸…ç†å’ŒçŠ¶æ€ç›‘æ§èƒ½åŠ›ã€‚

## èƒŒæ™¯/é—®é¢˜

å½“å‰ Agent ç¼ºå°‘äº¤äº’å¼ç»ˆç«¯ç®¡ç†èƒ½åŠ›ï¼Œæ— æ³•ï¼š
1. æ‰§è¡Œéœ€è¦äº¤äº’æˆ–ç›‘æ§çš„å­ä»»åŠ¡ï¼ˆå¦‚ç¼–è¯‘ã€æµ‹è¯•ï¼‰
2. è¿è¡Œåå°é•¿ä»»åŠ¡å¹¶éšæ—¶æŸ¥çœ‹çŠ¶æ€
3. å¯åŠ¨æœåŠ¡å¹¶æŒç»­ç›‘æ§æ—¥å¿—

å‚è€ƒ mitsuhiko/agent-stuff çš„ tmux æŠ€èƒ½ï¼Œéœ€è¦æ·±åº¦èå…¥ Pi Agent ä½“ç³»ã€‚

## éªŒæ”¶æ ‡å‡† (Acceptance Criteria)

- [ ] WHEN åˆ›å»ºä¼šè¯æ—¶ï¼Œç³»ç»Ÿ SHALL è‡ªåŠ¨è¾“å‡ºç›‘æ§å‘½ä»¤ç»™ç”¨æˆ·
- [ ] WHEN å‘é€æŒ‰é”®æ—¶ï¼Œç³»ç»Ÿ SHALL ä½¿ç”¨å­—é¢æ¨¡å¼é¿å… shell è½¬ä¹‰
- [ ] WHERE ä¼šè¯çŠ¶æ€å˜æ›´æ—¶ï¼Œç³»ç»Ÿ SHALL è‡ªåŠ¨æ›´æ–°æŒä¹…åŒ–å­˜å‚¨
- [ ] IF ä¼šè¯è¶…è¿‡ 24 å°æ—¶æœªæ´»åŠ¨ï¼Œç³»ç»Ÿ SHALL è‡ªåŠ¨æ¸…ç†
- [ ] WHEN æŸ¥è¯¢ä¼šè¯åˆ—è¡¨æ—¶ï¼Œç³»ç»Ÿ SHALL æ˜¾ç¤ºçŠ¶æ€å’Œæœ€åæ´»åŠ¨æ—¶é—´
- [ ] WHEN Agent å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿ SHALL è‡ªåŠ¨åŒæ­¥ tmux å®é™…çŠ¶æ€

## å®æ–½é˜¶æ®µ

### Phase 1: ç›®å½•ç»“æ„å’Œé…ç½®
- [x] åˆ›å»º `~/.pi/agent/skills/tmux/` ç›®å½•
- [x] åˆ›å»º `package.json` å’Œ `tsconfig.json`
- [x] å®šä¹‰ TypeScript ç±»å‹ï¼ˆ`types/index.ts`ï¼‰

### Phase 2: æ ¸å¿ƒåº“å®ç° (lib.ts)
- [x] å®ç° `TmuxManager` ç±»
- [x] å®ç°ä¼šè¯ç®¡ç†ï¼ˆåˆ›å»ºã€åˆ—è¡¨ã€æŸ¥è¯¢ã€åˆ é™¤ï¼‰
- [x] å®ç°äº¤äº’æ“ä½œï¼ˆå‘é€æŒ‰é”®ã€æ•è·è¾“å‡ºã€ç­‰å¾…æ–‡æœ¬ï¼‰
- [x] å®ç°ä¼šè¯ç›‘æ§ï¼ˆçŠ¶æ€æ£€æµ‹ã€æ´»åŠ¨æ›´æ–°ï¼‰
- [x] å®ç°è‡ªåŠ¨æ¸…ç†æœºåˆ¶
- [x] å®ç°æŒä¹…åŒ–å­˜å‚¨ï¼ˆJSON æ–‡ä»¶ï¼‰

### Phase 3: CLI æ¥å£
- [x] å®ç° `create` å‘½ä»¤
- [x] å®ç° `list` å‘½ä»¤
- [x] å®ç° `status` å‘½ä»¤
- [x] å®ç° `send` å‘½ä»¤
- [x] å®ç° `capture` å‘½ä»¤
- [x] å®ç° `kill` å‘½ä»¤
- [x] å®ç° `cleanup` å‘½ä»¤
- [x] å®ç° `attach` å‘½ä»¤
- [x] å®ç° `sync` å‘½ä»¤

### Phase 4: è¾…åŠ©è„šæœ¬å’Œç¤ºä¾‹
- [x] å¤åˆ¶ `wait-for-text.sh`ï¼ˆbash å…¼å®¹ï¼‰
- [x] å¤åˆ¶ `find-sessions.sh`
- [x] åˆ›å»º Python REPL ç¤ºä¾‹
- [x] åˆ›å»ºé•¿ä»»åŠ¡ç¤ºä¾‹
- [x] åˆ›å»ºæœåŠ¡å¯åŠ¨ç¤ºä¾‹

### Phase 5: æ–‡æ¡£å’Œé›†æˆ
- [x] ç¼–å†™ `SKILL.md`ï¼ˆé€‚é… Pi Agentï¼‰
- [ ] æ›´æ–° Agent åè®®çš„ Skills Registry
- [ ] æµ‹è¯•æ‰€æœ‰åœºæ™¯

## å…³é”®å†³ç­–

| å†³ç­– | ç†ç”± |
|------|------|
| ä½¿ç”¨ Bun + TypeScript | ç¬¦åˆ Agent æŠ€æœ¯æ ˆï¼Œç±»å‹å®‰å…¨ï¼Œæ€§èƒ½ä¼˜ç§€ |
| Socket ç›®å½•ï¼š`/tmp/pi-tmux-sockets` | é¿å…ä¸ç”¨æˆ· tmux å†²çªï¼Œç¬¦åˆ Pi å‘½åè§„èŒƒ |
| ä¼šè¯å‘½åï¼š`pi-{category}-{name}-{timestamp}` | é¿å…å†²çªï¼Œä¾¿äºè¯†åˆ«å’Œè¿‡æ»¤ |
| æŒä¹…åŒ–å­˜å‚¨ï¼šJSON æ–‡ä»¶ | ç®€å•å¯é ï¼Œæ˜“äºè·¨å¯¹è¯æ¢å¤ |
| è‡ªåŠ¨æ¸…ç†é˜ˆå€¼ï¼š24 å°æ—¶ | å¹³è¡¡èµ„æºå ç”¨å’Œç”¨æˆ·ä½“éªŒ |
| çŠ¶æ€ç›‘æ§ï¼šåŸºäº tmux å®é™…çŠ¶æ€ | ç¡®ä¿å‡†ç¡®æ€§ï¼Œé¿å…åƒµå°¸ä¼šè¯ |

## é‡åˆ°çš„é”™è¯¯

| æ—¥æœŸ | é”™è¯¯ | è§£å†³æ–¹æ¡ˆ |
|------|------|---------|
| 2025-01-07 | workhub create issue å¤±è´¥ï¼ˆæ–‡ä»¶åè¿‡é•¿æˆ–ç‰¹æ®Šå­—ç¬¦ï¼‰ | ä½¿ç”¨ç®€çŸ­æè¿° "tmux æŠ€èƒ½å®ç°" |

## ç›¸å…³èµ„æº

- [x] ç›¸å…³ Issue: `docs/issues/tmux/20260107-tmux æŠ€èƒ½å®ç°.md`
- [x] å‚è€ƒèµ„æ–™: https://github.com/mitsuhiko/agent-stuff/blob/main/skills/tmux/SKILL.md
- [ ] Agent åè®®: `~/.pi/agent/protocol.md`

## Notes

### æŠ€æœ¯è®¾è®¡è¦ç‚¹

1. **Socket ç®¡ç†**
   - ä½¿ç”¨ç‹¬ç«‹ socket è·¯å¾„é¿å…å¹²æ‰°ç”¨æˆ· tmux é…ç½®
   - é»˜è®¤ socketï¼š`/tmp/pi-tmux-sockets/pi.sock`
   - ç¯å¢ƒå˜é‡ï¼š`PI_TMUX_SOCKET_DIR` å¯è¦†ç›–

2. **ä¼šè¯åˆ†ç±»**
   - `task`: ä¸´æ—¶å­ä»»åŠ¡ï¼ˆç¼–è¯‘ã€æµ‹è¯•ï¼‰
   - `service`: é•¿æœŸè¿è¡ŒæœåŠ¡ï¼ˆå¼€å‘æœåŠ¡å™¨ï¼‰
   - `agent`: Agent è‡ªèº«ä»»åŠ¡ï¼ˆè®­ç»ƒã€æ•°æ®å¤„ç†ï¼‰

3. **çŠ¶æ€æ£€æµ‹**
   - `running`: è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œæœ‰æ–°è¾“å‡º
   - `idle`: è¿›ç¨‹å­˜åœ¨ä½†æ— æ–°è¾“å‡º
   - `exited`: è¿›ç¨‹å·²é€€å‡º

4. **å®‰å…¨æœºåˆ¶**
   - å‘é€æŒ‰é”®ä½¿ç”¨å­—é¢æ¨¡å¼ï¼ˆ`-l`ï¼‰é¿å… shell è½¬ä¹‰
   - æ¸…ç†å‰æ£€æŸ¥ tmux å®é™…çŠ¶æ€
   - æä¾›ç¡®è®¤æœºåˆ¶é˜²æ­¢è¯¯åˆ 

### CLI å‘½ä»¤è®¾è®¡

```bash
# åˆ›å»ºä¼šè¯
bun ~/.pi/agent/skills/tmux/lib.ts create <name> <command> [category]

# åˆ—å‡ºä¼šè¯
bun ~/.pi/agent/skills/tmux/lib.ts list [filter]

# æŸ¥çœ‹çŠ¶æ€
bun ~/.pi/agent/skills/tmux/lib.ts status <id>

# å‘é€æŒ‰é”®
bun ~/.pi/agent/skills/tmux/lib.ts send <id> <keys>

# æ•è·è¾“å‡º
bun ~/.pi/agent/skills/tmux/lib.ts capture <id> [lines]

# æ€æ­»ä¼šè¯
bun ~/.pi/agent/skills/tmux/lib.ts kill <id>

# æ¸…ç†æ—§ä¼šè¯
bun ~/.pi/agent/skills/tmux/lib.ts cleanup [hours]

# é™„åŠ åˆ°ä¼šè¯
bun ~/.pi/agent/skills/tmux/lib.ts attach <id>

# åŒæ­¥çŠ¶æ€
bun ~/.pi/agent/skills/tmux/lib.ts sync
```

### ç›®å½•ç»“æ„

```
~/.pi/agent/skills/tmux/
â”œâ”€â”€ SKILL.md                    # æ ¸å¿ƒæ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰
â”œâ”€â”€ lib.ts                      # TypeScript æ ¸å¿ƒåº“ + CLI
â”œâ”€â”€ package.json                # ä¾èµ–é…ç½®
â”œâ”€â”€ tsconfig.json               # TypeScript é…ç½®
â”œâ”€â”€ scripts/                    # è¾…åŠ©è„šæœ¬ï¼ˆbashï¼‰
â”‚   â”œâ”€â”€ wait-for-text.sh        # ç­‰å¾…æç¤ºç¬¦/æ–‡æœ¬å‡ºç°
â”‚   â””â”€â”€ find-sessions.sh        # æŸ¥æ‰¾ä¼šè¯
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ python-repl.ts          # Python REPL ç¤ºä¾‹
â”‚   â”œâ”€â”€ long-task.ts            # é•¿ä»»åŠ¡ç¤ºä¾‹
â”‚   â””â”€â”€ start-service.ts        # å¯åŠ¨æœåŠ¡ç¤ºä¾‹
â””â”€â”€ types/
    â””â”€â”€ index.ts                # TypeScript ç±»å‹å®šä¹‰
```

---

## Status æ›´æ–°æ—¥å¿—

- **2025-01-07 12:55**: çŠ¶æ€å˜æ›´ â†’ ğŸš§ è¿›è¡Œä¸­ï¼Œå¤‡æ³¨: Issue åˆ›å»ºå®Œæˆï¼Œå¼€å§‹å®æ–½ Phase 1
- **2025-01-07 13:00**: çŠ¶æ€å˜æ›´ â†’ âœ… å·²å®Œæˆï¼Œå¤‡æ³¨: æ‰€æœ‰ Phase å®Œæˆï¼Œtmux æŠ€èƒ½å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡